<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Bradley Congelio">
<title>Introduction to NFL Analytics with R - 4&nbsp; Data Visualization with NFL Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05-nfl-analytics-advanced-methods.html" rel="next">
<link href="./03-nfl-analytics-functions.html" rel="prev">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script defer="" data-domain="bradcongelio.com/nfl-analytics-with-r-book" src="https://plausible.io/js/script.js"></script><link rel="shortcut icon" href="favicon.ico">
<meta property="og:title" content="Introduction to NFL Analytics with R - 4&nbsp; Data Visualization with NFL Data">
<meta property="og:description" content="">
<meta property="og:image" content="https://bradcongelio.com/nfl-analytics-with-r-book/images/feature.png">
<meta property="og:site-name" content="Introduction to NFL Analytics with R">
<meta property="og:locale" content="es_ES">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
<meta name="twitter:title" content="Introduction to NFL Analytics with R - 4&nbsp; Data Visualization with NFL Data">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://bradcongelio.com/nfl-analytics-with-r-book/images/feature.png">
<meta name="twitter:creator" content="@bradcongelio">
<meta name="twitter:image-height" content="960">
<meta name="twitter:image-width" content="1344">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04-nfl-analytics-visualization.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with NFL Data</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to NFL Analytics with R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/bcongelio/nfl-analytics-with-r-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-nfl-analytics-and-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">An Introduction to NFL Analytics and the R Programming Language</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-nfl-analytics-tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Wrangling NFL Data in the <code>tidyverse</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-nfl-analytics-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">NFL Analytics with the <code>nflverse</code> Family of Packages</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-nfl-analytics-visualization.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with NFL Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-nfl-analytics-advanced-methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Advanced Model Creation with NFL Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-nfl-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a1-nfl-analytics-dictionary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">NFL Analytics Quick Reference Guide</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a2-nfl-further-reading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Further Reading Suggestions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a3-nfl-errata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Errata</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#data-viz-must-understand-the-audience" id="toc-data-viz-must-understand-the-audience" class="nav-link active" data-scroll-target="#data-viz-must-understand-the-audience"><span class="header-section-number">4.1</span> Data Viz Must Understand the Audience</a></li>
  <li><a href="#setting-up-for-data-viz" id="toc-setting-up-for-data-viz" class="nav-link" data-scroll-target="#setting-up-for-data-viz"><span class="header-section-number">4.2</span> Setting Up for Data Viz</a></li>
  <li><a href="#the-basics-of-using-ggplot2" id="toc-the-basics-of-using-ggplot2" class="nav-link" data-scroll-target="#the-basics-of-using-ggplot2"><span class="header-section-number">4.3</span> The Basics of Using <code>ggplot2</code></a></li>
  <li>
<a href="#building-a-data-viz-a-step-by-step-process" id="toc-building-a-data-viz-a-step-by-step-process" class="nav-link" data-scroll-target="#building-a-data-viz-a-step-by-step-process"><span class="header-section-number">4.4</span> Building A Data Viz: A Step-by-Step Process</a>
  <ul class="collapse">
<li><a href="#adding-team-colors-to-each-point" id="toc-adding-team-colors-to-each-point" class="nav-link" data-scroll-target="#adding-team-colors-to-each-point"><span class="header-section-number">4.4.1</span> Adding Team Colors to Each Point</a></li>
  <li><a href="#increasing-the-size-of-each-point" id="toc-increasing-the-size-of-each-point" class="nav-link" data-scroll-target="#increasing-the-size-of-each-point"><span class="header-section-number">4.4.2</span> Increasing The Size of Each Point</a></li>
  <li><a href="#adding-player-names-to-each-point" id="toc-adding-player-names-to-each-point" class="nav-link" data-scroll-target="#adding-player-names-to-each-point"><span class="header-section-number">4.4.3</span> Adding Player Names to Each Point</a></li>
  <li><a href="#editing-axis-ticks-and-values" id="toc-editing-axis-ticks-and-values" class="nav-link" data-scroll-target="#editing-axis-ticks-and-values"><span class="header-section-number">4.4.4</span> Editing Axis Ticks and Values</a></li>
  <li><a href="#changing-axis-titles-and-adding-title-subtitle-and-caption" id="toc-changing-axis-titles-and-adding-title-subtitle-and-caption" class="nav-link" data-scroll-target="#changing-axis-titles-and-adding-title-subtitle-and-caption"><span class="header-section-number">4.4.5</span> Changing Axis Titles and Adding Title, Subtitle, and Caption</a></li>
  <li><a href="#adding-mean-lines-to-both-x-axis-and-y-axis" id="toc-adding-mean-lines-to-both-x-axis-and-y-axis" class="nav-link" data-scroll-target="#adding-mean-lines-to-both-x-axis-and-y-axis"><span class="header-section-number">4.4.6</span> Adding Mean Lines to Both x-axis and y-axis</a></li>
  <li><a href="#making-changes-to-theme-elements" id="toc-making-changes-to-theme-elements" class="nav-link" data-scroll-target="#making-changes-to-theme-elements"><span class="header-section-number">4.4.7</span> Making Changes to Theme Elements</a></li>
  </ul>
</li>
  <li><a href="#creating-your-own-ggplot2-theme" id="toc-creating-your-own-ggplot2-theme" class="nav-link" data-scroll-target="#creating-your-own-ggplot2-theme"><span class="header-section-number">4.5</span> Creating Your Own <code>ggplot2</code> Theme</a></li>
  <li><a href="#using-team-logos-in-plots" id="toc-using-team-logos-in-plots" class="nav-link" data-scroll-target="#using-team-logos-in-plots"><span class="header-section-number">4.6</span> Using Team Logos in Plots</a></li>
  <li>
<a href="#creating-a-geom_line-plot" id="toc-creating-a-geom_line-plot" class="nav-link" data-scroll-target="#creating-a-geom_line-plot"><span class="header-section-number">4.7</span> Creating a <code>geom_line</code> Plot</a>
  <ul class="collapse">
<li><a href="#adding-secondary-geom_line-for-nfl-averages" id="toc-adding-secondary-geom_line-for-nfl-averages" class="nav-link" data-scroll-target="#adding-secondary-geom_line-for-nfl-averages"><span class="header-section-number">4.7.1</span> Adding Secondary <code>geom_line</code> For NFL Averages</a></li>
  </ul>
</li>
  <li><a href="#creating-a-geom_area-plot" id="toc-creating-a-geom_area-plot" class="nav-link" data-scroll-target="#creating-a-geom_area-plot"><span class="header-section-number">4.8</span> Creating a <code>geom_area</code> Plot</a></li>
  <li>
<a href="#creating-a-geom_col-plot" id="toc-creating-a-geom_col-plot" class="nav-link" data-scroll-target="#creating-a-geom_col-plot"><span class="header-section-number">4.9</span> Creating a <code>geom_col</code> Plot</a>
  <ul class="collapse">
<li><a href="#an-alternative-geom_col-plot" id="toc-an-alternative-geom_col-plot" class="nav-link" data-scroll-target="#an-alternative-geom_col-plot"><span class="header-section-number">4.9.1</span> An Alternative <code>geom_col</code> Plot</a></li>
  </ul>
</li>
  <li><a href="#creating-a-geom_box-plot" id="toc-creating-a-geom_box-plot" class="nav-link" data-scroll-target="#creating-a-geom_box-plot"><span class="header-section-number">4.10</span> Creating a <code>geom_box</code> Plot</a></li>
  <li><a href="#creating-a-geom_ridges-plot" id="toc-creating-a-geom_ridges-plot" class="nav-link" data-scroll-target="#creating-a-geom_ridges-plot"><span class="header-section-number">4.11</span> Creating a <code>geom_ridges</code> Plot</a></li>
  <li><a href="#creating-a-geom_violin-plot" id="toc-creating-a-geom_violin-plot" class="nav-link" data-scroll-target="#creating-a-geom_violin-plot"><span class="header-section-number">4.12</span> Creating a <code>geom_violin</code> Plot</a></li>
  <li><a href="#creating-a-geom_histogram-plot" id="toc-creating-a-geom_histogram-plot" class="nav-link" data-scroll-target="#creating-a-geom_histogram-plot"><span class="header-section-number">4.13</span> Creating a <code>geom_histogram</code> Plot</a></li>
  <li><a href="#saving-your-ggplot2-creations" id="toc-saving-your-ggplot2-creations" class="nav-link" data-scroll-target="#saving-your-ggplot2-creations"><span class="header-section-number">4.14</span> Saving Your <code>ggplot2</code> Creations</a></li>
  <li><a href="#advanced-headshots-method" id="toc-advanced-headshots-method" class="nav-link" data-scroll-target="#advanced-headshots-method"><span class="header-section-number">4.15</span> Advanced Headshots Method</a></li>
  <li><a href="#creating-tables-with-gt-and-gtextras" id="toc-creating-tables-with-gt-and-gtextras" class="nav-link" data-scroll-target="#creating-tables-with-gt-and-gtextras"><span class="header-section-number">4.16</span> Creating Tables with <code>gt</code> and <code>gtExtras</code></a></li>
  <li>
<a href="#creating-a-shiny-app" id="toc-creating-a-shiny-app" class="nav-link" data-scroll-target="#creating-a-shiny-app"><span class="header-section-number">4.17</span> Creating a Shiny App</a>
  <ul class="collapse">
<li><a href="#requirements-for-a-shiny-app" id="toc-requirements-for-a-shiny-app" class="nav-link" data-scroll-target="#requirements-for-a-shiny-app"><span class="header-section-number">4.17.1</span> Requirements for a Shiny App</a></li>
  <li><a href="#building-our-ui.r-file" id="toc-building-our-ui.r-file" class="nav-link" data-scroll-target="#building-our-ui.r-file"><span class="header-section-number">4.17.2</span> Building our <code>ui.R</code> File</a></li>
  <li><a href="#building-our-server.r-file" id="toc-building-our-server.r-file" class="nav-link" data-scroll-target="#building-our-server.r-file"><span class="header-section-number">4.17.3</span> Building our <code>server.R</code> File</a></li>
  </ul>
</li>
  <li>
<a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">4.18</span> Exercises</a>
  <ul class="collapse">
<li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1"><span class="header-section-number">4.18.1</span> Exercise 1</a></li>
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2"><span class="header-section-number">4.18.2</span> Exercise 2</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/bcongelio/nfl-analytics-with-r-book/edit/origin/04-nfl-analytics-visualization.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/bcongelio/nfl-analytics-with-r-book/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with NFL Data</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>During the original writing of this book, version 1.1.0 of <code>nflplotR</code> was used. However, a pending update (as of 8/18/2023) was going to result the plots using <code>nflplotR</code> for mean lines to “break” - that is, any plot that used the <code><a href="https://nflplotr.nflverse.com/reference/geom_lines.html">nflplotR::geom_mean_lines()</a></code> function. In the prior version, the aesthetics were provided via <code>v_var</code> and <code>h_var</code>.</p>
<p>Previously, the necessary aesthetics for <code><a href="https://nflplotr.nflverse.com/reference/geom_lines.html">nflplotR::geom_mean_lines()</a></code> were <code>v_var</code> (for the x-axis mean line) and <code>h_var</code> (for the y-axis mean line).</p>
<p>In response to a pending change in <code>ggplot2</code>, the aesthetics for mean lines with <code>nflplotR</code> in the forthcoming release will be <code>x0</code> and <code>y0</code>.</p>
<p><strong>Because the new release is not yet on CRAN, you <em>must</em>&nbsp;download the current development version of <code>nflplotR</code></strong> <strong>using the below code.</strong></p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/nflplot-r-development_904fc510e1dbc9ffa3f53db59b34980a">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://remotes.r-lib.org">"remotes"</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"nflverse/nflplotR"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Effective data visualization is an important part of any data analysis project as it helps in highlighting key insights into the data, identifying trends, patterns, and anomalies, as while as allowing you to communicate results to the outside world.</p>
<p>Jim Stikeleather, writing for the <em>Harvard Business Review</em>, outlined three key elements that make a successful data visualization (albeit, leaving <em>us</em> to decide the definition of what a “successful” data visualization is). Despite that philosophical gap, the three elements provided by Stikeleather are succinct enough to allow us to build a framework in this chapter for how to successfully craft an NFL analytics data visualization. In his piece, Stikeleather outlines the following three characteristics of a successful data visualization: it understands the audience, it sets up a clear framework, and it tells a story <span class="citation" data-cites="stikeleather2013">(<a href="06-nfl-references.html#ref-stikeleather2013" role="doc-biblioref">Stikeleather, 2013</a>)</span>.</p>
<p>To illustrate the importance of these three elements, let’s take a look at example visualizations using NFL data to further contextualize each one.</p>
<section id="data-viz-must-understand-the-audience" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="data-viz-must-understand-the-audience">
<span class="header-section-number">4.1</span> Data Viz Must Understand the Audience</h2>
<p>As explained by Stikeleather, the core purpose of a data visualization is to take “great quantities of information” and then convey that information in such a way that it is “easily assimilated by the consumers of the information.” In other words, the process of data visualization should allow for a great quantity of data to be distilled into an easily consumable (and understandable!) format.</p>
<p>Speaking specifically to NFL analytics, when doing visualizations we must be conscious about whether or not the intended audience will understand the terminology and concepts we use in the plot. For example, most all NFL fans understand the “non-advanced” statistics in the sport. But, when plots start using metrics such as EPA or completion percentage over expected, for example, the audience looking at the plot may very well have little understanding of what is being conveyed.</p>
<p>Because of this, most of my data visualizations include “directables” within the plot. These “directables” may be arrows that indicate which trends on the plot are “good” or they may be text within a scatterplot that explains what each quadrant means. Or, for example, I sometimes include a textual explanation of the “equation” used to develop a metric as seen below:</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/third-down-aggressiveness-open_a42f2fcf1db8ccf3be56181ef600fd61">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/finished-aggressiveness.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Joe Burrow was the most aggressive QB in the league when throwing on 3rd down</figcaption></figure>
</div>
</div>
</div>
<p>The above plot explores which QBs, from the 2020 season, were most aggressive on 3rd down with between 5 to 10 yards to go. Since “aggressiveness” is not a typical, day-to-day metric discussed by NFL fans, I included a “directable” within the subtitle of the plot that explained that the plot, first, was examining just 3rd down pass attempts within a specific yard range. And, second, I made the decision to include how “aggressiveness” was calculated by including the simple equation within the subtitle as well. Doing so allows even the most casual of NFL fans to easily understand what the plot is showing - in this case, that Joe Burrow’s 3rd down pass attempts with between 5 to 10 yards to go made it to the line of gain, or more, on 68% of his attempts. On the other hand, Drew Lock and Drew Brees were the least aggressive QBs in the line based on the same metric.</p>
</section><section id="setting-up-for-data-viz" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="setting-up-for-data-viz">
<span class="header-section-number">4.2</span> Setting Up for Data Viz</h2>
<p>While most of your journey through NFL analytics in this book required you to use the <code>tidyverse</code> and a handful of other packages, the process of creating compelling and meaningful data visualizations will require you to utilize multitudes of other packages. Of course, the most important is <code>ggplot2</code> which is already installed via the <code>tidyverse</code>. However, in order to recreate the visualizations included in this chapter, it is required that you install other R packages. To install the necessary packages, you can run the following code in RStudio:</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/installing-data-viz-packages_e5b7e23308194be13bb8ab777cbd0786">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"extrafont"</span>,</span>
<span>                   <span class="st">"ggrepel"</span>,</span>
<span>                   <span class="st">"ggimage"</span>,</span>
<span>                   <span class="st">"ggridges"</span>,</span>
<span>                   <span class="st">"ggtext"</span>,</span>
<span>                   <span class="st">"ggfx"</span>,</span>
<span>                   <span class="st">"geomtextpath"</span>,</span>
<span>                   <span class="st">"cropcircles"</span>,</span>
<span>                   <span class="st">"magick"</span>,</span>
<span>                   <span class="st">"glue"</span>,</span>
<span>                   <span class="st">"gt"</span>,</span>
<span>                   <span class="st">"gtExtras"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="the-basics-of-using-ggplot2" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="the-basics-of-using-ggplot2">
<span class="header-section-number">4.3</span> The Basics of Using <code>ggplot2</code>
</h2>
<p>The basics of any <code>ggplot</code> visualization involves three basic calls to information in a data set as well as stipulation which type of geom you would like to use:</p>
<ol type="1">
<li>the data set to be used in the visualization</li>
<li>an aesthetic call for the x-axis</li>
<li>an aesthetic call for the y-axis</li>
<li>your desired geom type</li>
</ol>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/example-ggplot-call_8080d646aa71f7b47e6f5d8a193f6139">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="st">'dataset_name'</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="st">'x_axsis'</span>, y <span class="op">=</span> <span class="st">'y_axis'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_type</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To showcase this, let’s use data from Sports Info Solutions regarding quarterback statistics when using play action versus when not using play action. To start, collect the data using the <code>vroom</code> function.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/gathering-play-action-data_147236f684ca6d468b914e096febb1be">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">play_action_data</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/pa-data"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To provide an easy-to-understand example of building a visualization with <code>ggplot</code>, let’s use each QB’s total yardage when using play action and when not. In this case, our two variable names are <code>yds</code> and <code>pa_yds</code> with the <code>yds</code> variable being placed on the x-axis and the <code>pa_yds</code> variable being placed on the y-axis.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is important to remember which axis is which as you begin to learn using <code>ggplot</code>:</p>
<p>The x-axis is the horizontal axis that runs left-to-right.</p>
<p>The y-axis is the vertical axis that runs top-to-bottom.</p>
</div>
</div>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/example-pa-action-plot_01755c25fdf423a96c464a28417c3660">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/example-pa-action-plot-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">A simplistic plot using <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code></figcaption></figure>
</div>
</div>
</div>
</section><section id="building-a-data-viz-a-step-by-step-process" class="level2" data-number="4.4"><h2 data-number="4.4" class="anchored" data-anchor-id="building-a-data-viz-a-step-by-step-process">
<span class="header-section-number">4.4</span> Building A Data Viz: A Step-by-Step Process</h2>
<p>Our newly created scatter plot is an excellent starting point for a more finely detailed visualization. While we are able to see the relationship between non-play action passing yards and those attempts that included play action, we are unable to discern which specific point is which quarterback - among other issues. To provide more detail and to “prettify” the plot, let’s discuss doing the following:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Our data visualization “to do list”:</p>
<ol type="1">
<li>Adding team colors to each point.</li>
<li>Increasing the size of each point.</li>
<li>Adding player names to each point.</li>
<li>Increasing the number of ticks on each axis.</li>
<li>Provide the numeric values in correct format (that is, including a <code>,</code> to correctly show thousands).</li>
<li>Rename the title of each axis.</li>
<li>Provide a title, subtitle, and caption for the plot.</li>
<li>Add mean lines to both the x-axis and y-axis</li>
<li>Change <code>theme</code> elements to make data viz more appealing.</li>
</ol>
</div>
</div>
<section id="adding-team-colors-to-each-point" class="level3" data-number="4.4.1"><h3 data-number="4.4.1" class="anchored" data-anchor-id="adding-team-colors-to-each-point">
<span class="header-section-number">4.4.1</span> Adding Team Colors to Each Point</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Much like anything in the R language, there are multiple ways to go about adding team colors (and logos, player headshots, etc.) to visualizations.</p>
<p>First, we can merge team color information into our <code>play_action_data</code> and then manually set the colors in our <code>geom_point</code> call.</p>
<p>Second, we can use the <code>nflplotR</code> package (which is part of the <code>nflverse</code>) to bring the colors in.</p>
<p>Both examples will be included in the below example.</p>
</div>
</div>
<p>To start, we will load team information using the <code>load_teams</code> function within <code>nflreadr</code>. In this case, we are requesting that the package provide only the 32 current NFL teams by including the <code>current = TRUE</code> argument. Conversely, setting the argument to <code>current = FALSE</code> will result in historical NFL teams being included in the data (the Oakland Raiders and St.&nbsp;Louis Rams, for example). We will also use the <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> verb from <code>dplyr</code> to gather just the variables we know we will need (<code>team_abbr</code>, <code>team_nick</code>, <code>team_color</code>, and <code>team_color2</code>.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>We are only including the <code>team_abbr</code> variable in this example because we are going to create the plot both with and without the use of <code>nflplotR</code>. As of the writing of this book, the newest development version of the package is 1.1.0.9004 and does not yet (if ever) provide support to use team nicknames. Because of this, we must include <code>team_abbr</code> in our merge since it is the team name version that is standardized for use in <code>nflplotR</code>.</p>
</div>
</div>
<p>After collecting the team information needed, we can conduct a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> to match the information by <code>team</code> in <code>play_action_data</code> and <code>team_nick</code> in the team information from <code>load_teams()</code> and then confirm the merge was successful by viewing the columns names in <code>play_action_data</code> with <code><a href="https://rdrr.io/r/base/colnames.html">colnames()</a></code>.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/merging-team-data-for-plot_fcc427972a9852b4258c465178f34c85">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">teams</span> <span class="op">&lt;-</span> <span class="fu">nflreadr</span><span class="fu">::</span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_teams.html">load_teams</a></span><span class="op">(</span>current <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">team_abbr</span>, <span class="va">team_nick</span>, <span class="va">team_color</span>, <span class="va">team_color2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">play_action_data</span> <span class="op">&lt;-</span> <span class="va">play_action_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">teams</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"team"</span> <span class="op">=</span> <span class="st">"team_nick"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">play_action_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the team color information now built into our <code>play_action_data</code>, we can include the correct team color for each point by including the <code>color</code> argument within our <code>geom_point</code>.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/adding-color-no-plotr_c420e2c57876aaeddd046a4486941810">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/adding-color-no-plotr-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding team colors to the plot</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>You may notice that we used the the <code>$</code> special operator to extract the <code>team_color</code> information within our <code>play_action_data</code> data frame. This is an extremely important distinction, as using the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> argument from <code>ggplot</code> and not using the <code>$</code> operator will result in a custom scale color being applied to each team, without the colors being correctly associated to a team.</p>
<p>To see this for yourself, you can run the example following code. <strong>Remember, this is an incorrect approach and serves to only highlight why the <code>$</code> special operator was used in the above code.</strong></p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/incorrect-use-of-aes_0c4592c2b5915cbd4ee51e9b7b8400f5">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">team_color</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/incorrect-use-of-aes-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">In order to bring team colors into the plot, we must use the <code>$</code> special operator and not the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> argument</figcaption></figure>
</div>
</div>
</div>
</div>
</div>
<p>As mentioned, the same result can be achieved using the <code>nflplotR</code> package. The following code will do so:</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/adding-color-with-plot_448ee6a932baaf17b6823909dcb12d71">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">team_abbr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nflplotR</span><span class="fu">::</span><span class="fu"><a href="https://nflplotr.nflverse.com/reference/scale_nfl.html">scale_color_nfl</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"primary"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/adding-color-with-plot-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding team colors to the plot with the <code>nflplotR</code> package</figcaption></figure>
</div>
</div>
</div>
<p>In the above example, you will notice that we are including the team color information in an <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> call within the <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> function. This is because we ultimately control the specifics of the custom scale through the use of <code>scale_color_nfl</code> in the <code>nflplotR</code> package, which also allows us to select whether we want to display the primary or secondary team color.</p>
<p>Given the two examples above, a couple items regarding the use of <code>nflplotR</code> should become apparent.</p>
<ol type="1">
<li>If your data already includes team names in <code>team_abbr</code> format (that is: BAL, CIN, DET, DAL, etc.), then using <code>nflplotR</code> is likely a more efficient option as you do not need to merge in team color information. In other words, our <code>play_action_data</code> information could contain just the variables for <code>player</code>, <code>team_abbr</code>, <code>yds</code>, and <code>pa_yds</code> and <code>nflplotR</code> would still work as the package, “behind the scenes”, automatically correlates the <code>team_abbr</code> with the correct color for each team.</li>
<li>However, if your data does not include teams in <code>team_abbr</code> format and you must merge in information manually, it is likely more efficient to use the <code>$</code> special operator to bring the team colors in without using the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> call within <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>.</li>
</ol>
<p>Finally, because we have both <code>team_color</code> and <code>team_color2</code> - the primary and secondary colors for each team - in the data, we can get fancy and create points that are filled with the primary team color and outlined by the secondary team color. Doing so simply requires changing the type of our <code>geom_point</code>. In the below example, we are specifying that we want a specific type of <code>geom_point</code> by using <code>shape = 21</code> and then providing the <code>fill</code> color and the outline color with <code>color</code>. In each case, we are again using the <code>$</code> special operator to select the primary and secondary color associated with each team.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/adding-shape-21-to-plot_a22a92e86e79cc67ba62756c57df14d1">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/adding-shape-21-to-plot-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Using a different <code>geom_poitn()</code> shape in order to utilize both team colors</figcaption></figure>
</div>
</div>
</div>
<p>With team colors correctly associated with each point, we can turn back to our “to do list” to see what part of the job is next.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Our data visualization “to do list”:</p>
<ol type="1">
<li><p><del>Adding team colors to each point.</del></p></li>
<li><p>Increasing the size of each point.</p></li>
<li><p>Adding player names to each point.</p></li>
<li><p>Increasing the number of ticks on each axis.</p></li>
<li><p>Provide the numeric values in correct format (that is, including a , to correctly show thousands).</p></li>
<li><p>Rename the title of each axis.</p></li>
<li><p>Provide a title, subtitle, and caption for the plot.</p></li>
<li><p>Add mean lines to both the x-axis and y-axis.</p></li>
<li><p>Change <code>theme</code> elements to make data viz more appealing.</p></li>
</ol>
</div>
</div>
</section><section id="increasing-the-size-of-each-point" class="level3" data-number="4.4.2"><h3 data-number="4.4.2" class="anchored" data-anchor-id="increasing-the-size-of-each-point">
<span class="header-section-number">4.4.2</span> Increasing The Size of Each Point</h3>
<p>Determining when and how to resize the individual points in a scatterplot is a multifaceted decision. To that end, there is no hard and fast rule for doing so as it depends on both the specific goals and context of the visualization. There are, however, some general guidelines to keep in mind:</p>
<ol type="1">
<li>
<strong>Data density:</strong> if you have a lot of data points within your plot, making the points smaller may help to reduce issues of overlapping/overplotting. Not only is this more aesthetically pleasing, but it can also help in making it easier to see patterns.</li>
<li>
<strong>Importance of individual points:</strong> if certain points within the scatterplot are important, we may want to increase the size of those specific points to make them standout.</li>
<li>
<strong>Visual aesthetics:</strong> the size of the points can be adjusted simply for visual appeal.</li>
<li>
<strong>Contextual factors:</strong> can the size of the points be used to highlight even more uniqueness in the data? For example, given the right data structure, we can size individual dots to show the spread in total attempts across the quarterbacks.</li>
</ol>
<p>Given the above guidelines, the resizing of the points in our <code>play_action_data</code> data frame is going to be a strictly aesthetic decision. We cannot, as mentioned above, alter the size of each specific points based on each quarterback’s number of attempts as the data provides attempts for <em>both</em> play action and non-play action passes. Moreover, we <em>could</em>&nbsp;create a new column that add both attempt numbers to get a QB’s cumulative total but that does not have a distinct correlation to the data on either axis.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>For the sake of educational purposes, we can alter the size of each specific point to correlate to the total number of play action attempts for each quarterback (and then divide this by 25 in order to decrease the size of the points to fit them all onto the plot).</p>
<p><strong>Again: it is important to point out that this not a good approach to data visualization, as the size of the points correlate to just one of the variables being explored in the plot.</strong></p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/incorrect-use-of-sizing_4de4c086810de7b42852064849e0c8f1">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span>,</span>
<span>             size <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">pa_att</span> <span class="op">/</span> <span class="fl">25</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/incorrect-use-of-sizing-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">An incorrect approach to sizing the points, as the size correltes to just one of the variables</figcaption></figure>
</div>
</div>
</div>
</div>
</div>
<p>In order to maintain correct visualization standards, we can resize the points for nothing more than aesthetic purposes (that is: making them bigger so they are easier to see). To do so, we still add the <code>size</code> argument to our <code>geom_point</code> but providing a numeric value to apply uniformly across all the points. To process of selecting the numeric value is a case of trial and error - inputting and running, changing and running, and changing and running again until you find the size that provides easier to see points without adding overlap into the visualization.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/adding-correct-size-to-points_ddf1c3b30ef3bbcfb22a98f21ffcf264">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">4.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/adding-correct-size-to-points-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Resizing the points for aesthetic purposes</figcaption></figure>
</div>
</div>
</div>
<p>With the size of each point adequately adjusted, we can move on to the next part of our data visualization “to do list.”</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Our data visualization “to do list”:</p>
<ol type="1">
<li><p><del>Adding team colors to each point.</del></p></li>
<li><p><del>Increasing the size of each point.</del></p></li>
<li><p>Adding player names to each point.</p></li>
<li><p>Increasing the number of ticks on each axis.</p></li>
<li><p>Provide the numeric values in correct format (that is, including a , to correctly show thousands).</p></li>
<li><p>Rename the title of each axis.</p></li>
<li><p>Provide a title, subtitle, and caption for the plot.</p></li>
<li><p>Add mean lines to both the x-axis and y-axis.</p></li>
<li><p>Change <code>theme</code> elements to make data viz more appealing.</p></li>
</ol>
</div>
</div>
</section><section id="adding-player-names-to-each-point" class="level3" data-number="4.4.3"><h3 data-number="4.4.3" class="anchored" data-anchor-id="adding-player-names-to-each-point">
<span class="header-section-number">4.4.3</span> Adding Player Names to Each Point</h3>
<p>While the our current plot includes team-specific colors for the points, we are still not able to discern - for the most part - which player belongs to which point. To rectify this, we will turn to using the <code>ggrepel</code> package, which is designed to improve the readability of text labels on plots by automatically repelling overlapping labels, if any. <code>ggrepel</code> operates with the use of two main functions: <code>geom_text_repel</code> and <code>geom_label_repel</code>. Both provide the same end result, with the core difference being <code>geom_label_repel</code> adding a customized label under each player’s name.</p>
<p>We can do a bare minimum addition of the player names by adding one additional line of code using <code>geom_text_repel</code>, wrapping it in an <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> call, and specifying which variable in the <code>play_action_data</code> is the <code>label</code> we would like to display.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/basic-addition-of-names_240a60c02aeac72a957fc36bd2d53535">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">4.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">player</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/basic-addition-of-names-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding player names to the plot</figcaption></figure>
</div>
</div>
</div>
<p>While it is a good first attempt at adding the names, many of them are awkwardly close to the respective point. Luckily, the <code>ggrepel</code> package provides plenty of built-in customization options:</p>
<table class="table">
<thead><tr class="header">
<th style="text-align: center;">
<code>ggrepel</code> Option<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>
</th>
<th style="text-align: center;">Description of Option</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">seed</td>
<td style="text-align: center;">a random numeric seed number for the purposes of recreating the same layout</td>
</tr>
<tr class="even">
<td style="text-align: center;">force</td>
<td style="text-align: center;">force of repulsion between overlapping text labels</td>
</tr>
<tr class="odd">
<td style="text-align: center;">force_pull</td>
<td style="text-align: center;">force of attraction between each text label and its data point</td>
</tr>
<tr class="even">
<td style="text-align: center;">direction</td>
<td style="text-align: center;">move the text labels in either “x” or “y” directions</td>
</tr>
<tr class="odd">
<td style="text-align: center;">nudge_x</td>
<td style="text-align: center;">adjust the starting x-axis starting position of the label</td>
</tr>
<tr class="even">
<td style="text-align: center;">nudge_y</td>
<td style="text-align: center;">adjust the starting y-axis starting position of the label</td>
</tr>
<tr class="odd">
<td style="text-align: center;">box.padding</td>
<td style="text-align: center;">padding around the text label</td>
</tr>
<tr class="even">
<td style="text-align: center;">point.padding</td>
<td style="text-align: center;">padding around the labeled data point</td>
</tr>
<tr class="odd">
<td style="text-align: center;">arrow</td>
<td style="text-align: center;">renders the line segment as an arrow</td>
</tr>
</tbody>
</table>
<p>Of the above options, the our current issue with name and point spacing can be resolved by including a numeric value to the <code>box.padding</code>. Moreover, we can control the look and style of the text (such as size, font family, font face, etc.) in much the same way. To make these changes, we can set the <code>box.padding</code> to 0.45, set the size of the text to three using <code>size</code> as well as switch the font to ‘Roboto’ using <code>family</code>, and - finally - make it bold using <code>fontface</code>.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/adding-ggrepel-options_dfbf950550b89a2f1fb08e3cfd441d9e">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">4.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">player</span><span class="op">)</span>,</span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                  family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                  fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/adding-ggrepel-options-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding options from <code>ggrepel</code> to the player names</figcaption></figure>
</div>
</div>
</div>
<p>The plot, as is, is understandable in that we are able to associate each point with a specific quarterback to examine how a quarterback’s total passing yardage is split between play action and non-play action passes. While the graph could hypothetically “standalone” as is - minus a need for a title - we can still do work on it to make it more presentable. Let’s return to our data visualization “to do list.”</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Our data visualization “to do list”:</p>
<ol type="1">
<li><p><del>Adding team colors to each point.</del></p></li>
<li><p><del>Increasing the size of each point.</del></p></li>
<li><p><del>Adding player names to each point.</del></p></li>
<li><p>Increasing the number of ticks on each axis.</p></li>
<li><p>Provide the numeric values in correct format (that is, including a , to correctly show thousands).</p></li>
<li><p>Rename the title of each axis.</p></li>
<li><p>Provide a title, subtitle, and caption for the plot.</p></li>
<li><p>Add mean lines to both x-axis and y-axis.</p></li>
<li><p>Change <code>theme</code> elements to make data viz more appealing.</p></li>
</ol>
</div>
</div>
</section><section id="editing-axis-ticks-and-values" class="level3" data-number="4.4.4"><h3 data-number="4.4.4" class="anchored" data-anchor-id="editing-axis-ticks-and-values">
<span class="header-section-number">4.4.4</span> Editing Axis Ticks and Values</h3>
<p>Because steps four and five from the above “to do list” can be accomplished with the same package, we will lump both together and complete them at once.</p>
<p>Let’s first examine the idea of increasing the number of ticks on each axis. The “axis ticks” refer to the specific spots on each axis wherein a numeric data point resides. With our current visualization, we currently have “1000, 2000, 3000” on the x-axis and “400, 800, 1200, 1600” on the y-axis.</p>
<p>We may want to increase the number of axis ticks in this visualization as it can provide a more detailed view of the data being presented. Typically, increasing the number of tickets will show more granularity in the data and make it easier to interpret the values represented by each point. In this specific case, we can look at the cluster of points represented by Andy Dalton, Mac Jones, and Matt Ryan. Given the current structure of the axis ticks, we can guess that Matt Ryan has roughly 2,500 yards on non-play action passing attempts. Given we know Matt Ryan’s amount, we can make guesses that Andy Dalton may be around 2,300 and Mac Jones somewhere between the two.</p>
<p>By increasing the number of values on each axis, we have the ability to see more specific results. Conversely, we must be careful to not add too many so that the data becomes overwhelming to interpret. Much like the size of <code>geom_point</code> was a case of trial and error, so is selecting an appropriate amount of ticks.</p>
<p>However, before implementing these changes, we need to segue into a discussion on continuous and discrete data.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>When implementing changes to either the x- or y-axis in <code>ggplot</code>, you will be working with either continuous or discrete data, and using the <code>scale_x_continuous</code> or <code>scale_x_discrete</code> functions (replacing <code>x</code> with <code>y</code> when working with the opposite axis). In either case, both functions allow you to customize the axis of a plot but are used for different types of data.</p>
<p><code>scale_x_continuous</code> is used for continuous (or numeric) data, where the axis is represented by a continuous range of numeric values. The values within a continuous axis can take on any number within the given range.</p>
<p><code>scale_x_discrete</code> is used for discrete data (or often character-based data). You will see this function used when working with variables such as player names, teams, college names, etc. In any case, discrete data is limited to a specific set of categories.</p>
<p>Please know that <code>ggplot</code> will throw an error if you try to apply a continuous scale to discrete data, or the opposite, that reads: <code>Error: Discrete value supplied to continuous scale</code>.</p>
</div>
</div>
<p>In the case of our current plot, we now know we will be using the <code>scales_x_continuous</code> and <code>scale_y_continuous</code> functions as both contain continuous (numeric) data. To make the changes, we can turn to the <code>scales</code> package and its <code>pretty_breaks</code> function to change the number of “breaks” (or ticks) on each axis. By placing <code>n = 6</code> within the <code>pretty_breaks</code> argument, we are requesting a total of six axis ticks on both the x- and y-axis.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/adding-breaks-with-scales_0cbaa4a6a2c57b8552171722edcab913">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">4.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">player</span><span class="op">)</span>,</span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                  family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                  fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/adding-breaks-with-scales-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Changing numbers of breaks on each axis with <code>pretty_breaks()</code></figcaption></figure>
</div>
</div>
</div>
<p>Despite our request to build the plot with six ticks on each axis, you will see the generated visualization includes seven on the x-axis and eight on the y-axis. <em>This does not mean your code with <code>pretty_breaks</code></em> <em>did not work</em>. Instead, the <code>pretty_breaks</code> function is designed to internally determine the best axis tick optimization based on your requested number. To that end, the function determined that seven and eight ticks, respectively, was the most optimized way to display the data given our desire to have at least six on each.</p>
<p>With the number of axis ticks corrected, we can turn our attention to getting the labels of the axis ticks into correct numeric format. Within the same <code>scale_x_continuous</code> or <code>scale_y_continuous</code> arguments, we will use the <code>labels</code> function, combined with another tool from the <code>scales</code> package to make the adjustments.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/adding-commas-to-values_4d49fe966470df7c9c0aeeb48c0f18d5">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">4.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">player</span><span class="op">)</span>,</span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                  family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                  fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/adding-commas-to-values-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding commas to the axis values using <code>label_comma()</code></figcaption></figure>
</div>
</div>
</div>
<p>By adding a <code>labels</code> option to both <code>scale_x_continuous</code> and <code>scale_y_continuous</code>, we can use the <code>label_comma()</code> option from within the <code>scales</code> package to easily add a comma into numbers that are in the thousands.</p>
<p>With much of the heavy lifting for our visualization now complete, we can move on to the final steps in our “to do list.”</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Our data visualization “to do list”:</strong></p>
<ol type="1">
<li><p><del>Adding team colors to each point.</del></p></li>
<li><p><del>Increasing the size of each point.</del></p></li>
<li><p><del>Adding player names to each point.</del></p></li>
<li><p><del>Increasing the number of ticks on each axis.</del></p></li>
<li><p><del>Provide the numeric values in correct format (that is, including a , to correctly show thousands).</del></p></li>
<li><p>Rename the title of each axis.</p></li>
<li><p>Provide a title, subtitle, and caption for the plot.</p></li>
<li><p>Add mean lines to both x-axis and y-axis.</p></li>
<li><p>Change <code>theme</code> elements to make data viz more appealing.</p></li>
</ol>
</div>
</div>
</section><section id="changing-axis-titles-and-adding-title-subtitle-and-caption" class="level3" data-number="4.4.5"><h3 data-number="4.4.5" class="anchored" data-anchor-id="changing-axis-titles-and-adding-title-subtitle-and-caption">
<span class="header-section-number">4.4.5</span> Changing Axis Titles and Adding Title, Subtitle, and Caption</h3>
<p>Much like our last section, we can work on changing the title of each axis and adding a title, subtitle, and caption for the plot within one section, as all this is added and/or changed by using <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code>.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/using-labs-for-title-stuff_6034bdfb56f2a88dc26485648b59acfd">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">4.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">player</span><span class="op">)</span>,</span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                  family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                  fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Non-Play Action Yards"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Play Action Yards"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Cumulative Passing Yards"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Non-Play Action vs. Play Action"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*Introduction to NFL Analytics with R*&lt;br&gt;**Bradley J. Congelio**"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/using-labs-for-title-stuff-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding the plot’s title and subtitle</figcaption></figure>
</div>
</div>
</div>
<p>Within the new <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code>, we are placing a total of five items: <code>x</code> (allowing us to name the x-axis outside the confines of what it is called in the beginning <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> call, <code>y</code> (allowing us to name the y-axis), <code>title</code> (allowing us to add a title to the top of the plot), <code>subtitle</code> (allowing us to add a subtitle below the title and provide more contextual information), and <code>caption</code> (allowing us to provide information about where the graph come from and who designed it). We will explore ways to change the font, size, color, and more of these items when we move on to the last item of our “to do list.”</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Our data visualization “to do list”:</strong></p>
<ol type="1">
<li><p><del>Adding team colors to each point.</del></p></li>
<li><p><del>Increasing the size of each point.</del></p></li>
<li><p><del>Adding player names to each point.</del></p></li>
<li><p><del>Increasing the number of ticks on each axis.</del></p></li>
<li><p><del>Provide the numeric values in correct format (that is, including a , to correctly show thousands).</del></p></li>
<li><p><del>Rename the title of each axis.</del></p></li>
<li><p><del>Provide a title, subtitle, and caption for the plot.</del></p></li>
<li><p>Add mean lines to both x-axis and y-axis.</p></li>
<li><p>Change theme elements to make data viz more appealing.</p></li>
</ol>
</div>
</div>
</section><section id="adding-mean-lines-to-both-x-axis-and-y-axis" class="level3" data-number="4.4.6"><h3 data-number="4.4.6" class="anchored" data-anchor-id="adding-mean-lines-to-both-x-axis-and-y-axis">
<span class="header-section-number">4.4.6</span> Adding Mean Lines to Both x-axis and y-axis</h3>
<p>Adding mean (or average) lines to both the x-axis and y-axis allows us to visualize where each quarterback falls within one of four sections (according to the amount of passing yards in both situations). Adding the lines is done with the inclusion of two additional geoms to the existing plot (in this case <code>geom_hline</code> and <code>geom_vline</code>).</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/adding-mean-lines-incorrectly_94e3efe5a8a71a6b33d6c8048d53f396">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">4.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">player</span><span class="op">)</span>,</span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                  family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                  fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Non-Play Action Yards"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Play Action Yards"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Cumulative Passing Yards"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Non-Play Action vs. Play Action"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">play_action_data</span><span class="op">$</span><span class="va">pa_yds</span><span class="op">)</span>,</span>
<span>             linewidth <span class="op">=</span> <span class="fl">.8</span>, color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">play_action_data</span><span class="op">$</span><span class="va">yds</span><span class="op">)</span>,</span>
<span>             linewidth <span class="op">=</span> <span class="fl">.8</span>, color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/adding-mean-lines-incorrectly-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding mean lines incorrectly, as they are top of every layer</figcaption></figure>
</div>
</div>
</div>
<p>In the above output, we used <code>geom_hline</code> and <code>geom_vline</code> to draw a dashed line at the average for both <code>pa_yds</code> at the <code>yintercept</code> and <code>yds</code> at the <code>xintercept</code>. Because of this, we can see that - for example - Marcus Mariota is above average for play action yards, but below average for non-play action yards. Additionally, Matthew Stafford, Baker Mayfield, Kyler Murray, and many others are all below average in both metrics while Jared Goff, Justin Herbert, Patrick Mahomes, and others are well above average in both.</p>
<p>However, adding the <code>geom_hline</code> and <code>geom_vline</code> at the very end of the <code>ggplot</code> code creates an issues (and one I’ve intentionally created for the purposes of education). As you look at the plot, you will see that the dashed line runs <strong>on top</strong> of the names and dots in the plot. This is because <code>ggplot</code> follows a very specific ordering of layering.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>In <code>ggplot</code>, it is important to remember that items in a plot are layered in the order in which they are added to the plot.</strong> This process of layering is important because it ultimately determines which items end up on top of others, which can have significant implications on the visual appearance of the plot.</p>
<p>As we’ve seen so far in the process, each layer of a plot is added by including a <code>geom_</code>. The first layer added will <em>always</em> be at the very bottom of the plot, with each additional layer building on top of the previous layers.</p>
</div>
</div>
<p>Because of the important layering issue highlighted above, it is visually necessary for us to move the <code>geom_hline</code> and <code>geom_vline</code> to the beginning of the <code>ggplot</code> code so both are layered underneath everything else in the plot (<code>geom_point</code> and <code>geom_text_repel</code> in this case). As well, we can apply the <code>alpha</code> option to each to slightly decrease each line’s transparency.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/correctly-adding-mean-lines_bcb950f03f0998f0c1bfa66d8fe762e1">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">play_action_data</span><span class="op">$</span><span class="va">pa_yds</span><span class="op">)</span>, </span>
<span>             linewidth <span class="op">=</span> <span class="fl">.8</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">play_action_data</span><span class="op">$</span><span class="va">yds</span><span class="op">)</span>, </span>
<span>             linewidth <span class="op">=</span> <span class="fl">.8</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">4.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">player</span><span class="op">)</span>,</span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                  family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                  fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Non-Play Action Yards"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Play Action Yards"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Cumulative Passing Yards"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Non-Play Action vs. Play Action"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/correctly-adding-mean-lines-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding mean lines at beginning of code so they are a bottom layer of the plot</figcaption></figure>
</div>
</div>
</div>
<p>By moving the average lines to the top of our <code>ggplot</code> code, both are now layered under the other two <code>geom_</code> and are not visually impacting the final plot.</p>
<section id="adding-mean-lines-with-nflplotr" class="level4" data-number="4.4.6.1"><h4 data-number="4.4.6.1" class="anchored" data-anchor-id="adding-mean-lines-with-nflplotr">
<span class="header-section-number">4.4.6.1</span> Adding Mean Lines with <code>nflplotR</code>
</h4>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Even though we were not able to use <code>nflplotR</code> to handle the colors in this plot because the data lacked a corresponding <code>team_abbr</code> variable, we can still use <code>nflplotR</code> to add our mean lines - and I actually recommend doing so, as it requires less lines of code (thus less typing). See below for an example.</p>
</div>
</div>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/means-lines-with-nflplotr_24d22551ecc93938d108e9a11f4dd290">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_mean_lines</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">yds</span>, y0 <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span>, </span>
<span>                  size <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                  color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                  linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>                  alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">4.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">player</span><span class="op">)</span>,</span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                  family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                  fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Non-Play Action Yards"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Play Action Yards"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Cumulative Passing Yards"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Non-Play Action vs. Play Action"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/means-lines-with-nflplotr-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding mean lines with nflplotR</figcaption></figure>
</div>
</div>
</div>
<p>By using the <code>geom_mean_lines()</code> function within <code>nflplotR</code>, we can construct both of the lines together rather than needing to provide a <code><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline()</a></code> and a <code><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline()</a></code> argument. Because of this, we can also provide the size, width, and type of our line just once (rather than repeating it again like we had to in the former method).</p>
<p>We can now move onto the final item on our data visualization “to do list.”</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Our data visualization “to do list”:</strong></p>
<ol type="1">
<li><p><del>Adding team colors to each point.</del></p></li>
<li><p><del>Increasing the size of each point.</del></p></li>
<li><p><del>Adding player names to each point.</del></p></li>
<li><p><del>Increasing the number of ticks on each axis.</del></p></li>
<li><p><del>Provide the numeric values in correct format (that is, including a , to correctly show thousands).</del></p></li>
<li><p><del>Rename the title of each axis.</del></p></li>
<li><p><del>Provide a title, subtitle, and caption for the plot.</del></p></li>
<li><p><del>Add mean lines to both x-axis and y-axis.</del></p></li>
<li><p>Change theme elements to make data viz more appealing.</p></li>
</ol>
</div>
</div>
</section></section><section id="making-changes-to-theme-elements" class="level3" data-number="4.4.7"><h3 data-number="4.4.7" class="anchored" data-anchor-id="making-changes-to-theme-elements">
<span class="header-section-number">4.4.7</span> Making Changes to Theme Elements</h3>
<p>There is a laundry list of options to be explored when it comes to editing your plot’s theme elements to make it look exactly as you want. Currently, according to the <code>ggplot2</code> website, the following is a comprehensive list of elements that you can tinker with.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/ggplot2-theme-elements_272a2357560740e06d041ae8bc68eb1d">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>  line,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  rect,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  text,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  title,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  aspect.ratio,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  axis.title,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  axis.title.x,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  axis.title.x.top,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  axis.title.x.bottom,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  axis.title.y,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  axis.title.y.left,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  axis.title.y.right,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  axis.text,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  axis.text.x,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  axis.text.x.top,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  axis.text.x.bottom,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  axis.text.y,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  axis.text.y.left,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  axis.text.y.right,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  axis.ticks,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  axis.ticks.x,</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  axis.ticks.x.top,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  axis.ticks.x.bottom,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  axis.ticks.y,</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  axis.ticks.y.left,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  axis.ticks.y.right,</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  axis.ticks.length,</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  axis.ticks.length.x,</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  axis.ticks.length.x.top,</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  axis.ticks.length.x.bottom,</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  axis.ticks.length.y,</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  axis.ticks.length.y.left,</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  axis.ticks.length.y.right,</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  axis.line,</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  axis.line.x,</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  axis.line.x.top,</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>  axis.line.x.bottom,</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>  axis.line.y,</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  axis.line.y.left,</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  axis.line.y.right,</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>  legend.background,</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>  legend.margin,</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  legend.spacing,</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>  legend.spacing.x,</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>  legend.spacing.y,</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>  legend.key,</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>  legend.key.size,</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>  legend.key.height,</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>  legend.key.width,</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>  legend.text,</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>  legend.text.align,</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>  legend.title,</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>  legend.title.align,</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>  legend.position,</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>  legend.direction,</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>  legend.justification,</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>  legend.box,</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>  legend.box.just,</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>  legend.box.margin,</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>  legend.box.background,</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>  legend.box.spacing,</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>  panel.background,</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>  panel.border,</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>  panel.spacing,</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>  panel.spacing.x,</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>  panel.spacing.y,</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>  panel.grid,</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>  panel.grid.major,</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>  panel.grid.minor,</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>  panel.grid.major.x,</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>  panel.grid.major.y,</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>  panel.grid.minor.x,</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>  panel.grid.minor.y,</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>  panel.ontop,</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>  plot.background,</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>  plot.title,</span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>  plot.title.position,</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>  plot.subtitle,</span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>  plot.caption,</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>  plot.caption.position,</span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>  plot.tag,</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>  plot.tag.position,</span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>  plot.margin,</span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>  strip.background,</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>  strip.background.x,</span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>  strip.background.y,</span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>  strip.clip,</span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>  strip.placement,</span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>  strip.text,</span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>  strip.text.x,</span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>  strip.text.x.bottom,</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>  strip.text.x.top,</span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>  strip.text.y,</span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a>  strip.text.y.left,</span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a>  strip.text.y.right,</span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>  strip.switch.pad.grid,</span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>  strip.switch.pad.wrap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It’s not likely that we will encounter all these theme elements in this book. But, the ones we do use, we will use heavily. For example, I prefer to design all of my data visualizations without the “axis ticks” (those small lines sticking out from the plot just above, or beside, each yardage number).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Please note the keywords in the above paragraph: “<strong>I prefer.”</strong></p>
<p>Nearly all the work you conduct within the <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> of your data visualizations are just that - your preference. I very much have a “personal preference” that unites all the data viz work that I do and share for public consumption.</p>
<p>You can feel free to follow along with my preferences, including the use of the upcoming <code>nfl_analytics_theme()</code> I will provide, or to make slight (or major!) adjustments to everything we cover in the coming section to make it fit your artistic vision.</p>
<p>Be creative and do not be afraid to experiment with all the options available to you in <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code>.</p>
</div>
</div>
<p>Let’s start by removing the ticks on both the x- and y-axis. To do so, we will add the <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> argument at the end of your prior <code>ggplot</code> code and then start building out each and every change we want to make from the above list of options.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/using-theme-to-remove-ticks_677f9fc6a6a718cb2fbe5d772a9e8ba6">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_mean_lines</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>v_var <span class="op">=</span> <span class="va">yds</span>, h_var <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span>, </span>
<span>                  size <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                  color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                  linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>                  alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">4.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">player</span><span class="op">)</span>,</span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                  family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                  fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Non-Play Action Yards"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Play Action Yards"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Cumulative Passing Yards"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Non-Play Action vs. Play Action"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    axis.ticks <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/using-theme-to-remove-ticks-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Editing theme to remove axis ticks</figcaption></figure>
</div>
</div>
</div>
<p>Within the <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> argument, we take the specific element we wish to change (from the above list of possibilities from the <code>ggplot2</code> website) and then provide the instruction on what to do. In this case, since we wish to completely remove the <code>axis.ticks</code> from the entire plot, we can provide <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank()</a></code> which removes them. We can continue making changes to the plot’s elements by adding all of these preferences to out <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code>.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/adding-theme-elements-to-plot_12e33eb5f3cc4f1f1ef480ee389594c1">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_mean_lines</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>v_var <span class="op">=</span> <span class="va">yds</span>, h_var <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span>, </span>
<span>                  size <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                  color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                  linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>                  alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">4.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">player</span><span class="op">)</span>,</span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                  family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                  fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Non-Play Action Yards"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Play Action Yards"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Cumulative Passing Yards"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Non-Play Action vs. Play Action"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    axis.ticks <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                              size <span class="op">=</span> <span class="fl">10</span>, </span>
<span>                              color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                             face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>                             size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                             color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    plot.title.position <span class="op">=</span> <span class="st">"plot"</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                              size <span class="op">=</span> <span class="fl">16</span>,</span>
<span>                              face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>                              color <span class="op">=</span> <span class="st">"#E31837"</span>,</span>
<span>                              vjust <span class="op">=</span> <span class="fl">.02</span>,</span>
<span>                              hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                                 size <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                                 color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>                                 hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                                size <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                                face <span class="op">=</span> <span class="st">"italic"</span>,</span>
<span>                                color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.major <span class="op">=</span>  <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#d0d0d0"</span><span class="op">)</span>,</span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#f7f7f7"</span><span class="op">)</span>,</span>
<span>    plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#f7f7f7"</span><span class="op">)</span>,</span>
<span>    panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/adding-theme-elements-to-plot-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding a multitude of theme elements to the plot</figcaption></figure>
</div>
</div>
</div>
<p>There is a lot going on now in our <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> argument. Importantly, you may notice that we used <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank()</a></code> to remove the axis tick marks, but then switched to using <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect()</a></code> for the reminder of the edits with our <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code>. Both are one of four theme elements that can be modified in the above fashion.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>The Four Theme Elements You Can Edit</strong></p>
<p>When working on editing your plot to your liking, you can make changes using one of four theme elements:</p>
<ol type="1">
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank()</a></code> - this used to entirely remove an element from the plot like we did with <code>axis.ticks</code>.</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect()</a></code> - this is used to make changes to the borders and backgrounds of a plot.</li>
<li>
<code>element_lines()</code> - this is used to make changes to any element in the plot that is a line.</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text()</a></code> - this is used to make change to any element in the plot that is text.</li>
</ol>
</div>
</div>
<p>We first made changes to the text of the title associated with the x- and y-axis and made edits to the text of the numeric values for each yardage distance. This process is started by using <code>axis.title</code> and <code>axis.text</code> in conjunction with <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text()</a></code>, since that is the specific element type we are wishing to edit. Within our <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text()</a></code>, we provided the numerous argument on how we wished to edit the text by providing the <code>family</code> (or the font), the <code>face</code>, the <code>size</code>, and the <code>color</code>.</p>
<p>After, we got a little fancy in our edits to our plots title and subtitle. I knew that I wanted to center both directly in the middle of the plot. Rather than figuring out the specific horizontal adjustment needed, I used the <code>plot.title.position()</code> argument and set it to <code>"plot"</code>, which used the entire width of our plot as the reference point for where to center the plot title and subtitle.</p>
<p>To take advantage of this, we followed by using the <code>plot.title()</code> argument to set the title’s horizontal adjustment to 0.5 (<code>hjust = 0.5</code>). As you may guess, the inclusion of 0.5 instructs the output to center the title (and the subtitle in the ensuing edit) directly over the middle of the plot (as calculated through our prior use of <code>plot.title.position()</code>.</p>
<p>Our next significant change occurred by changing the aesthetics of the plot’s grid lines, background, and border. Because we are working with line and background elements, we switch from <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text()</a></code> and begin to use either <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line()</a></code> or <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect()</a></code> (as well as again using <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank()</a></code> to completely remove the panel’s minor grid lines).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>In a plot, which are the minor grid lines and which are the major?</strong></p>
<p>In a <code>ggplot2</code> plot, <strong>minor grid lines</strong> are those lines that hit either the x- or y-axis between the continuous or discrete values. Conversely, <strong>major grid lines</strong> are the lines that hit the axis at the same spot as the data values.</p>
<p>In the case of the current plot, our major grid lines are those that hit the x-axis at 500, 1,000, 1,500, and so on and hit the y-axis at 400, 600, 800, etc. The minor grid lines met the axis between the major grid lines.</p>
</div>
</div>
<p>After removing the panel’s minor grid lines (again, a personal preference of mine), we also change the color of the panel’s major grid lines, then change the color of the plot’s background (both using <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect()</a></code>). The end result is a aesthetically pleasing data visualization.</p>
</section></section><section id="creating-your-own-ggplot2-theme" class="level2" data-number="4.5"><h2 data-number="4.5" class="anchored" data-anchor-id="creating-your-own-ggplot2-theme">
<span class="header-section-number">4.5</span> Creating Your Own <code>ggplot2</code> Theme</h2>
<p>As mentioned, I have a distinctive “brand and look” for the data visualizations I create that make use of the same design elements and choices. Rather than copy and paste those into each and every <code>ggplot</code> piece of code I write, I’ve opted to consolidate all the <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> element changes into my own <code>nfl_analytics_theme()</code> function. In much the same way, I’ve created a “quick and easy” theme for use in this book. To get started, running the following chunk of code will create a function titled <code>nfl_analytics_theme</code> and place it into your RStudio environment.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/providing-theme-code_59fb18fb04cc7273b77147489e0db3c3">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nfl_analytics_theme</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">base_size</span> <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Roboto"</span>, size <span class="op">=</span> <span class="va">base_size</span><span class="op">)</span>,</span>
<span>      axis.ticks <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>                                face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>      axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>                               face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>      plot.title.position <span class="op">=</span> <span class="st">"plot"</span>,</span>
<span>      plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span>,</span>
<span>                                face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>                                color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>                                vjust <span class="op">=</span> <span class="fl">.02</span>,</span>
<span>                                hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>      plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>                                   hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>      plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                                  face <span class="op">=</span> <span class="st">"italic"</span>,</span>
<span>                                  color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>      panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid.major <span class="op">=</span>  <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#d0d0d0"</span><span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#f7f7f7"</span><span class="op">)</span>,</span>
<span>      plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#f7f7f7"</span><span class="op">)</span>,</span>
<span>      panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You may notice that the elements in the above theme creation are quite similar to the ones we passed into our previous plot. And that is true, and the results will be nearly 99.9% identical. After wrapping our <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> inside a function, indicated by the opening and closing curly brackets <code><a href="https://rdrr.io/r/base/Paren.html">{ }</a></code>, we can provide our desired theme element appearances as we would within a regular <code>ggplot2</code> code block.</p>
<p>However, in the above theme function, we have streamlined the basis a bit by indicating a <code>base_size</code> of all the text, when means all text output will be in size 12 font unless specifically indicated in the element (for example, we have the <code>plot.title</code> set to have a <code>size</code> of 16). As well, the same process was done for font (Roboto) so there was not a need to type it repeatedly into every element.</p>
<p>Based on the above example, you are free to create as detailed a theme function as you desire. The beauty of creating your own theme like above is you will no longer need to edit each portion of the every plot element.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/showcasing-use-of-theme_87b60c46f3b2772f3504e54f7ae86bd7">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_mean_lines</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>v_var <span class="op">=</span> <span class="va">yds</span>, h_var <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span>, </span>
<span>                  size <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                  color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                  linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>                  alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">4.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">player</span><span class="op">)</span>,</span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                  family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                  fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Non-Play Action Yards"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Play Action Yards"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"**Cumulative Passing Yards**"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"*Non-Play Action vs. Play Action*"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/showcasing-use-of-theme-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Consolidating theme element changes into <code>nfl_analytics_theme()</code></figcaption></figure>
</div>
</div>
</div>
<p>As you can see, we just consolidated 28 lines of code into a <strong>single line of code by wrapping all our theme elements into an easy to construct function.</strong></p>
<p>Unfortunately, you will notice that the resulting plot does not output with the title (“Cumulative Passing Yards”) in Kansas City red like in our original. This is because, in our <code>nfl_analytics_theme()</code> function, the <code>color</code> for <code>axis.title()</code> is set to <code>"black"</code>. Thankfully, we can make this small edit within our <code>ggplot</code> code to switch the title back to Kansas City red, highlighting the idea that - despite the theme being built into a function - we still have the ability to make necessary edits on the fly without including all 28 lines of code. With the <code>nfl_analytics_theme()</code> active, we can still add additional <code>theme</code> elements as needed to make modifications, as seen below.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/theme-code-with-modification_0eaeab9120e80487d99264006539b737">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">play_action_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yds</span>, y <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_mean_lines</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>v_var <span class="op">=</span> <span class="va">yds</span>, h_var <span class="op">=</span> <span class="va">pa_yds</span><span class="op">)</span>, </span>
<span>                  size <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                  color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                  linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>                  alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>             color <span class="op">=</span> <span class="va">play_action_data</span><span class="op">$</span><span class="va">team_color2</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">4.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">player</span><span class="op">)</span>,</span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                  family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                  fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Non-Play Action Yards"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Play Action Yards"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"**Cumulative Passing Yards**"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"*Non-Play Action vs. Play Action*"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_markdown</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#E31837"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/theme-code-with-modification-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Editing the color of the plot’s title after including <code>nfl_analytics_theme()</code></figcaption></figure>
</div>
</div>
</div>
</section><section id="using-team-logos-in-plots" class="level2" data-number="4.6"><h2 data-number="4.6" class="anchored" data-anchor-id="using-team-logos-in-plots">
<span class="header-section-number">4.6</span> Using Team Logos in Plots</h2>
<p>To explore the process of placing team logos into a plot, let’s stick with our previous example of working with play action passing data but explore it at the team level rather than individual quarterbacks. To gather the data, we can use <code>vroom</code> to read it in from the book’s GitHub.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/gathering-team-play-action_29ea6c39950298352d9bca980afdd0f8">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">team_playaction</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/team-pa"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting <code>team_playaction</code> data contains nearly identical information to the previous QB-level data. However, there is a slight change in how Sports Info Solutions charts passing yards on the team level. You will notice a column for both <code>net_yds</code> and <code>gross_yds</code>. When charting passing attempts in football, a player’s individual passing yards are aggregated under <strong>gross yards</strong> with all lost yardage resulting from a sack being included. On the other hand, team passing yards are always presented in <strong>net yards</strong> and any lost yardage from sacks are not included. Case in point, the <code>gross_yds</code> number in our <code>team_playaction</code> data is greater than the <code>net_yds</code> for all 32 NFL teams. In any case, we will build our data visualization using <code>net_yds</code>.</p>
<p>In order to include team logos in the plot, we must first merge in team logo information (again with the understanding that we could use <code>nflplotR</code> if team abbreviations were included in the data). We can collect the team logo information using the <code>load_teams()</code> function within <code>nflreadR</code>. There are three different variations of each team’s logo available in the resulting data: (1.) the logo from ESPN, (2.) the logo from Wikipedia, (3.) a pre-edited version of the logo that is cropped into a square.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>There are slight differences in disk space, pixels, and utility in the provided ESPN, Wikipedia, and squared versions of the logos.</strong></p>
<p>The Wikipedia versions are, generally, smaller in size. The Arizona Cardinals logo, for example, is just 9.11 KB in size from Wikipedia while the ESPN version of the logo is 20.6 KB. This difference in disk size is the result of each image’s dimensions and pixels. The ESPN version, with the larger disk size, is also a higher quality image that is scaled in 500x500 dimensions (and 500 pixels). The Wikipedia version is scaled in 179x161 dimensions at 179 pixels and 161 pixels, respectively. The squared version of the logo is a 200x200 image at 200 pixels with a background matching the team’s primary color.</p>
<p>What does this mean? The ESPN version of the logo is better for those applications where the logo will be large and you do not want any loss of quality. The Wikipedia version, conversely, is better suited for applications like ours: for use in a small-scale data visualization. We do not plan on “blowing up” the image, thus losing quality and the smaller disk space size of the images allows for a slightly quicker rendering time when we use the <code>ggimage</code> package. While sparingly used, the squared version of the logo can be used in certain data visualization applications that requires the team logo to quickly and easily “merge” into the background of the plot (more on this later in this chapter, though).</p>
</div>
</div>
<p>Because of the above explanation, we can collect just the team nicknames and the Wikipedia version of the logo to merge into our existing <code>team_playaction</code> data.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/team-pa-logo-merge_f505415c45b10246ec76bf6d2b20c0e6">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">teams</span> <span class="op">&lt;-</span> <span class="fu">nflreadr</span><span class="fu">::</span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_teams.html">load_teams</a></span><span class="op">(</span>current <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">team_nick</span>, <span class="va">team_logo_wikipedia</span><span class="op">)</span></span>
<span></span>
<span><span class="va">team_playaction</span> <span class="op">&lt;-</span> <span class="va">team_playaction</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">teams</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"team"</span> <span class="op">=</span> <span class="st">"team_nick"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">team_playaction</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the data now containing the correct information, we can build a basic version of our data visualization using the same <code>geom_point</code> as above, and continue to configure the information on both the x- and y-axis, to verify that everything is working correctly before switching out <code>geom_point</code> for <code>geom_image</code> in order to bring the team logos into the plot.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/building-initial-team-pa_58d2d57a144b237222d9ecb79d9f5f10">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">team_playaction</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">net_yds</span>, y <span class="op">=</span> <span class="va">pa_net_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">team_playaction</span><span class="op">$</span><span class="va">pa_net_yds</span><span class="op">)</span>, </span>
<span>             linewidth <span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">team_playaction</span><span class="op">$</span><span class="va">net_yds</span><span class="op">)</span>, </span>
<span>             linewidth <span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"**Net Passing Yards Without Play Action vs. With Play Action**"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"*2022 NFL Regular Season*"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Net Yards Without Play Action"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Net Yards With Play Action"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/building-initial-team-pa-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Building the plot before adding team logos instead of points</figcaption></figure>
</div>
</div>
</div>
<p>The resulting plot, constructed in nearly an identical manner to our above example, looks correct and we are ready to swap out <code>geom_point</code> for team logos.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Before proceeding with this next step, be sure that you have the <code>ggimage</code> package installed and loaded.</p>
</div>
</div>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/team-logos-without-aspect_802cd87ba23278a2f6dd1f2af65c4bd6">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">team_playaction</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">net_yds</span>, y <span class="op">=</span> <span class="va">pa_net_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">team_playaction</span><span class="op">$</span><span class="va">pa_net_yds</span><span class="op">)</span>, </span>
<span>             linewidth <span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">team_playaction</span><span class="op">$</span><span class="va">net_yds</span><span class="op">)</span>, </span>
<span>             linewidth <span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_image</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>image <span class="op">=</span> <span class="va">team_logo_wikipedia</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"**Net Passing Yards Without Play Action vs. With Play Action**"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"*2022 NFL Regular Season*"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Net Yards Without Play Action"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Net Yards With Play Action"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/team-logos-without-aspect-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Using team logos without including an aspect ratio</figcaption></figure>
</div>
</div>
</div>
<p>By using the <code>geom_image</code> function, we are able to wrap the <code>image</code> argument within an aesthetics call (that is, <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>) and then stipulate that the <code>team_logo_wikipedia</code> variable is to serve as the image associated with each data point.</p>
<p>But, wait: <strong>the image looks horrible, right?</strong> Indeed, the logos are pixelated, are skewed in shape, and are just generally unpleasant to look at.</p>
<p>That is because we failed to provide an aspect ratio for the team logos. In this case, we need to add <code>asp = 16/9</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Why are we including a specific aspect ratio of 16/9 for each team logo? Good question.</strong></p>
<p>An aspect ratio of 16/9 refers to the proportional relationship between the width and height of a rectangular display or image. In this case, the width of the image is 16 units, and the height is 9 units. Importantly, this aspect ratio is commonly used for widescreen displays, including most (if not all) modern televisions, computer monitors, and smartphones.</p>
<p>As well, the 16/9 aspect ratio is sometimes referred to as 1.78:1, which means that the width is 1.78 times the height of the image. This aspect ratio is wider than the traditional 4:3 aspect ratio that was common used in older television and CRT-based computer monitors.</p>
</div>
</div>
<p>We can make the quick adjustment in our prior code to provide the correct aspect ratio for each of our team logos:</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/logos-with-correct-ratio_52fcfe87c62229384f4ef215968cf489">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">team_playaction</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">net_yds</span>, y <span class="op">=</span> <span class="va">pa_net_yds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">team_playaction</span><span class="op">$</span><span class="va">pa_net_yds</span><span class="op">)</span>, </span>
<span>             linewidth <span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">team_playaction</span><span class="op">$</span><span class="va">net_yds</span><span class="op">)</span>, </span>
<span>             linewidth <span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_image</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>image <span class="op">=</span> <span class="va">team_logo_wikipedia</span><span class="op">)</span>, asp <span class="op">=</span> <span class="fl">16</span><span class="op">/</span><span class="fl">9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_comma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"**Net Passing Yards Without Play Action vs. With Play Action**"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"*2022 NFL Regular Season*"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Net Yards Without Play Action"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Net Yards With Play Action"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/logos-with-correct-ratio-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Using team logos with the correct 16/9 aspect ratio</figcaption></figure>
</div>
</div>
</div>
</section><section id="creating-a-geom_line-plot" class="level2" data-number="4.7"><h2 data-number="4.7" class="anchored" data-anchor-id="creating-a-geom_line-plot">
<span class="header-section-number">4.7</span> Creating a <code>geom_line</code> Plot</h2>
<p>A <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> plot is useful when you want to display the trends and/or relationships in data over a continuous variable (such as seasons). In that context a <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> plot can be used to explore player statistics over time (such as passing yards and rushing yards), or to do the same but at the team level, or even comparing one team against another by including two (or more!) lines on one plot.</p>
<p>Like all other <code>geom_</code> types, the basic foundation of a line graph can be created by, first, calling the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function and then adding <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> after. To begin building our first line graph, let’s read in the below data that contains information regarding the fourth-down attempt percentages by the Philadelphia Eagles into a data frame titled <code>eagles_fourth_downs</code>.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/reading_in_eagles_fourth_0a6c6bb0d06d40b35090ee4e46857d54">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">eagles_fourth_downs</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/phi-4th-downs"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data frames includes information regarding the <code>season</code>, the <code>total</code> fourth downs in each season, the number of fourth-down attempts in <code>total_go</code>, and the conversion percentage in <code>go_pct</code>. As well, the data has already been joined with information from <code><a href="https://nflreadr.nflverse.com/reference/load_teams.html">nflreadr::load_teams()</a></code> to include colors and logos.</p>
<p>Let’s build the foundation of the plot by using <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> and placing the <code>season</code> on the x-axis and the <code>go_pct</code> on the y-axis.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/eagles-line-1_289595b11dce014f424bc68a219d9b5a">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">eagles_fourth_downs</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">season</span>, y <span class="op">=</span> <span class="va">go_pct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/eagles-line-1-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Building the foundation of a line plot</figcaption></figure>
</div>
</div>
</div>
<p>The above output is a very basic line graph. Based on this output, we can start making modifications to multiple items to reach the end result in a step-by-step fashion. First, let’s explore making changes to scale of both the x and y-axis. Given that this is an examination of a yearly statistic, the x-axis should include every season in the data frame. The y-axis can be changed to be whole numbers, and to include the <code>%</code> after each number.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/eagles-line-2_77fa7448f5d67baef5f7c5647f15c02f">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">eagles_fourth_downs</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">season</span>, y <span class="op">=</span> <span class="va">go_pct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2012</span>, <span class="fl">2022</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/eagles-line-2-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Editing axis details</figcaption></figure>
</div>
</div>
</div>
<p>Please note that difference in how the <code>breaks</code> on each scale was handled. Because we want each year on the x-axis, we manually controlled the output by using the <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> function to start the x-axis at <code>2012</code> and to increase by <code>1</code> until the final number of <code>2022</code> is reached. On the other hand, we used the <code>pretty_breaks()</code> function from <code>scales</code> to format the number of breaks on the y-axis and then used <code>percent_format()</code> to edit the labels to be whole numbers with the percentage sign included.</p>
<p>Next, we can add more <code>geom_</code> types to highlight the general percentage for each season on the x-axis. We will add one <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> to to indicate the percentage for each season. And then, for aesthetic purposes, we will add a <em>second</em> <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> that is larger than the original, with a color that matches the eventual background, to give the visual impression that the line doesn’t quite “reach” the point. Lastly, because we are dealing with aesthetic issues like size and color, we will increase the size of the <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> and also add the Eagles’ secondary team color to it.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/eagles-line-3_1afceeaed959a0bff4152bb533bb2147">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">eagles_fourth_downs</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">season</span>, y <span class="op">=</span> <span class="va">go_pct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="va">eagles_fourth_downs</span><span class="op">$</span><span class="va">team_color2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span>, color <span class="op">=</span> <span class="st">"#f7f7f7"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="va">eagles_fourth_downs</span><span class="op">$</span><span class="va">team_color</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2012</span>, <span class="fl">2022</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/eagles-line-3-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding points to the line</figcaption></figure>
</div>
</div>
</div>
<p>The order in which we apply all three <code>geom_</code> types is important because, as previously discussed, a <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> is layered with the first items being placed under the items that come next. In this case, <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> is under the first <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> which is then placed under the second <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>.</p>
<p>To complete the visualization, we can attached our custom <code>nfl_analytics_theme()</code> and then use <code>xlab</code>, <code>ylab</code>, and <code>labs</code> to edit the titles of the each axis and to include a title, subtitle, and caption.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/eagles-line-4_9e9fca18cfa980eedc81286111fde657">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">eagles_fourth_downs</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">season</span>, y <span class="op">=</span> <span class="va">go_pct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="va">eagles_fourth_downs</span><span class="op">$</span><span class="va">team_color2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span>, color <span class="op">=</span> <span class="st">"#f7f7f7"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="va">eagles_fourth_downs</span><span class="op">$</span><span class="va">team_color</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2012</span>, <span class="fl">2022</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Season"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Go For It Percentage"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"**Philadelphia Eagles: Fourth-Down Attempt Percentage**"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"*2012 - 2022: Regular Season*"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/eagles-line-4-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding the finishing touches to the `geom_line() plot</figcaption></figure>
</div>
</div>
</div>
<p>The resulting visualization shows cases how often the Philadelphia Eagles went for it on fourth down between 2012 and 2022. The upward trend , especially starting in 2019, generally follows an established trend among NFL head coaches. Given that, how does the Eagles’ trend compare to the rest of the NFL?</p>
<p>We can visualize this by adding a second <code>geom_line</code> that shows the averaged <code>go_pct</code> for the other 31 NFL teams.</p>
<section id="adding-secondary-geom_line-for-nfl-averages" class="level3" data-number="4.7.1"><h3 data-number="4.7.1" class="anchored" data-anchor-id="adding-secondary-geom_line-for-nfl-averages">
<span class="header-section-number">4.7.1</span> Adding Secondary <code>geom_line</code> For NFL Averages</h3>
<p>The <code>combined_fourth_data</code> data frame created by running the below code includes the same information as before for the Philadelphia Eagles, but also includes the <code>NFL</code> as a <code>posteam</code> for the 2012-2022 seasons along with the total fourth down attempt and conversion rate.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/reading_combined_line_data_d9ce95ecbf73e2ce4f6e340da354d399">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">combined_fourth_data</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/4th-data"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The addition of a second <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> to the plot - one that belongs to the Eagles and one that belongs to averaged number for all other NFL teams - requires a few new additions to our previous code. First, in the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> call, we’ve added <code>group = posteam</code>. Because the data is structured so that <code>PHI</code> and <code>NFL</code> are both observations in the <code>posteam</code> column, the use of <code>group = posteam</code> instructs <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> to “split” that information into two and to create a <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> for each. Second, we’ve added <code>scale_color_manual</code> to the code and manually assigned the appropriate hex code colors to each like (<code>#004C54</code> for the Eagles and <code>#013369</code> for the rest of the NFL).</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/finished-two-line_2fa05529d2525cf300ddca964a81c2a5">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">combined_fourth_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">season</span>,</span>
<span>                                 y <span class="op">=</span> <span class="va">go_pct</span>,</span>
<span>                                 group <span class="op">=</span> <span class="va">posteam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">posteam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#013369"</span>, <span class="st">"#004C54"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span>, color <span class="op">=</span> <span class="st">"#f7f7f7"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">posteam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2012</span>, <span class="fl">2022</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Season"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Go For It Percentage"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"**Philadelphia Eagles vs. NFL: Fourth-Down Attempt Percentage**"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"*2012 - 2022: Regular Season*"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/finished-two-line-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding a secondary line to compare to the NFL average</figcaption></figure>
</div>
</div>
</div>
<p>The resulting visualization does a very good job at showing the upward trend in head coaches going for it on fourth down and that the Eagles are consistently more aggressive in such situations than the rest of the NFL.</p>
</section></section><section id="creating-a-geom_area-plot" class="level2" data-number="4.8"><h2 data-number="4.8" class="anchored" data-anchor-id="creating-a-geom_area-plot">
<span class="header-section-number">4.8</span> Creating a <code>geom_area</code> Plot</h2>
<p>A <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area()</a></code> plot is similar to a <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> plot in that it is also often used to display quantitative data over a continuous variable. The core difference, however, is that the <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area()</a></code> plot provides the ability to fill in the surface area between the x-axis and the line. To showcase this, the <code>mahomes_epa</code> data frame created by running the below code contains Patrick Mahomes’ average EPA for each week of the 2022 regular season, as well as the opponent and the opponent’s team logo.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/reading_mahomes_epa_data_10730a44e104381e7ca65149cc4e056e">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mahomes_epa</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/mahomes_epa"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The basics of the completed plot can be output by placing <code>week</code> on the x-axis and <code>mean_qb_epa</code> on the y-axis and then using <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area()</a></code>. Also included in the <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area()</a></code> are two arguments (<code>fill</code> and <code>alpha</code>). The hex color for the Kansas City Chiefs’ secondary color is provided to “fill” in the area and then the <code>alpha</code> is set to 0.4 to make it slightly transparent.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/mahomes-epa-1_3db4d8415dffa470f859bfd350ab90e9">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mahomes_epa</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">mean_qb_epa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_area</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#FFB612"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/mahomes-epa-1-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Building the foundation of a <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area()</a></code> plot</figcaption></figure>
</div>
</div>
</div>
<p>To help the <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area()</a></code> “pop” a bit more off the background, we will now included a <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> that “rides” across the top of the <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area()</a></code> and also add <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> to show the week-by-week trend of Mahomes’ average EPA.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/mahomes-epa-2_7c67eb51e8e105a4285e05a0dfa6f720">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mahomes_epa</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">mean_qb_epa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_area</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#FFB612"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#E31837"</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/mahomes-epa-2-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> and `geom_line() with team color</figcaption></figure>
</div>
</div>
</div>
<p>While the plot does provide information regarding Mahomes’ average EPA, we still do not know who he was playing on any given week. To add this information, we can use the <code>geom_image()</code> function from <code>ggimage</code> to add the logo of each opponent to the points of the <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area()</a></code>.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/mahomes-epa-3_7ce8a3fe987289f9fa673e2b800aa4e9">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mahomes_epa</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">mean_qb_epa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_area</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#FFB612"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#E31837"</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_image</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>image <span class="op">=</span> <span class="va">team_logo_wikipedia</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.045</span>, asp <span class="op">=</span> <span class="fl">16</span><span class="op">/</span><span class="fl">9</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/mahomes-epa-3-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding logos of the opponent to the line</figcaption></figure>
</div>
</div>
</div>
<p>With the logos of each opponent added, we can turn to the finishing touches including adding our custom theme, changing the title of each axis, and adding a title. We also need to make edits to the scale of each axis, again using <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> to include all 18 weeks on the x-axis.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/mahomes-epa-4_8a733a0cb5fc5bdca6fc5045af8e8fef">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mahomes_epa</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">mean_qb_epa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_area</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#FFB612"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#E31837"</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_image</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>image <span class="op">=</span> <span class="va">team_logo_wikipedia</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.045</span>, asp <span class="op">=</span> <span class="fl">16</span><span class="op">/</span><span class="fl">9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">18</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Week"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Average QB EPA"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"**Patrick Mahomes: Mean QB EPA per Week**"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"*2022 Regular Season*"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/mahomes-epa-4-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding finishing touches to the <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area()</a></code> plot</figcaption></figure>
</div>
</div>
</div>
<p>The finished visualization indicates that Mahomes’ had his highest average EPA in week 1 against the Arizona Cardinals (at roughly 0.8) before dropping considerably for week two through six. However, after a spike in week 7 against the 49ers, the <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> shows a continued downward trend for the remainder of the season, including four poor performances (by Mahomes’ standard, anyways) against the Broncos, Seahawks, and Raiders to end the season.</p>
</section><section id="creating-a-geom_col-plot" class="level2" data-number="4.9"><h2 data-number="4.9" class="anchored" data-anchor-id="creating-a-geom_col-plot">
<span class="header-section-number">4.9</span> Creating a <code>geom_col</code> Plot</h2>
<p>To begin creating our <code>geom_col</code> plot, we will use <code>vroom</code> to gather the necessary data into a data frame titled <code>qb_thirddown_data</code>.&nbsp;The resulting data frame includes the top ten quarterback in “third down aggressiveness.” The metric is calculated by first gathering the total number of 3rd down passing attempts by each quarterback with 10 or less yards to go. A pass attempt is considered “aggressive” if the total air yards is equal to - or greater than - the needed yards to go. Based on this calculation, Tua Tagovailoa was the most aggressive quarterback on 3rd downs during the 2022 regular season.</p>
<p>Because this is <em>not</em> a metric that is constructed against a continuous variable (such as <code>season</code> in the <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> examples), we turn to using <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code>.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/geom_col_data_fb8c27098efb4d265bdef989a7030403">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">qb_thirddown_data</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/qb-3rd-data"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To start, we will place <code>passer_id</code> on the x-axis and <code>qb_agg_pct</code> on the y-axis. However, to make sure the columns are plotted in descending order, we use the <code><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder()</a></code> function to arrange <code>passer_id</code> in descending order by the <code>qb_agg_pct</code> variable.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/geom_col_reorder_5b9c037c762a480f1cba372a27514610">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">qb_thirddown_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">passer_id</span>, <span class="op">-</span><span class="va">qb_agg_pct</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">qb_agg_pct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/geom_col_reorder-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Reordering the quarterbacks in descending order by aggressiveness percentage</figcaption></figure>
</div>
</div>
</div>
<p>The resulting plot is a solid foundation and just needs aesthetic adjustments and additions to bring it to the final version. We will first use the <code>fill</code> argument to add the respective team colors to each column and then the <code>color</code> argument to add the secondary team color as an outline to each column.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/geom_col_adding_color_e01da1dd4d00a2c084e1a66a70af7f47">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">qb_thirddown_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">passer_id</span>, <span class="op">-</span><span class="va">qb_agg_pct</span><span class="op">)</span>,</span>
<span>                                     y <span class="op">=</span> <span class="va">qb_agg_pct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">qb_thirddown_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>           color <span class="op">=</span> <span class="va">qb_thirddown_data</span><span class="op">$</span><span class="va">team_color2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/geom_col_adding_color-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Add team colors to each column</figcaption></figure>
</div>
</div>
</div>
<p>Next we can make adjustments to each axis. Using <code>scale_y_continuous</code>, we will set the number of breaks with <code>pretty_breaks()</code> and then use <code>percent_format()</code> to adjust the scale into whole numbers with the accompanying percentage sign. The <code><a href="https://tidyr.tidyverse.org/reference/expand.html">expand()</a></code> argument is used is set to <code>c(0,0)</code> to get rid of the “dead space” between the bottom of each column and the y-axis.</p>
<p>We can also provide the <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab()</a></code>, <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab()</a></code>, and include our custom <code>nfl_analytics_theme()</code> to the plot.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/geom_col_cleaning_scales_9372ee6007ddc6ff1963807dff53d712">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">qb_thirddown_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">passer_id</span>, <span class="op">-</span><span class="va">qb_agg_pct</span><span class="op">)</span>,</span>
<span>                                     y <span class="op">=</span> <span class="va">qb_agg_pct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">qb_thirddown_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>           color <span class="op">=</span> <span class="va">qb_thirddown_data</span><span class="op">$</span><span class="va">team_color2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"QB Aggressiveness on 3rd Down"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/geom_col_cleaning_scales-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Use the <code>scales</code> package to edit each axis</figcaption></figure>
</div>
</div>
</div>
<p>We will provide two ways to identify which column belong to which quarterback: by adding the player name to the column and by including each player’s headshot at the bottom of each.</p>
<p>To place the player name on each column, we will use <code><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text()</a></code> wrapped inside the <code>with_outer_glow()</code> function (which is part of the <code>ggfx</code> package). The <code>with_outer_glow()</code> function allows us to apply a drop shadow effect to the text, making sure that it is easy to read on the colored background of each column. The <code>geom_text</code> function accepts the arguments relating to the <code>angle</code>, horizontal adjustment <code>hjust</code>, <code>color</code>, font family, font face, and size of the text. The <code>with_outer_glow</code> function is used to apply the <code>sigma</code> (how dark or light to make the shadow/glow), <code>expand</code> (how far to spread out the glow/shadow), and <code>color</code>.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/geom_col_adding_names_43f6127f219644114bea8fbc748a00fd">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">qb_thirddown_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">passer_id</span>, <span class="op">-</span><span class="va">qb_agg_pct</span><span class="op">)</span>,</span>
<span>                                     y <span class="op">=</span> <span class="va">qb_agg_pct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">qb_thirddown_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>           color <span class="op">=</span> <span class="va">qb_thirddown_data</span><span class="op">$</span><span class="va">team_color2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">with_outer_glow</span><span class="op">(</span><span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">passer</span><span class="op">)</span>,</span>
<span>                            position <span class="op">=</span> <span class="fu">position_stack</span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">.98</span><span class="op">)</span>,</span>
<span>                            angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">.98</span>, color <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>                            family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                            fontface <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>                  sigma <span class="op">=</span> <span class="fl">6</span>, expand <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"QB Aggressiveness on 3rd Down"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/geom_col_adding_names-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding player names with text effects using the <code>ggfx</code> package</figcaption></figure>
</div>
</div>
</div>
<p>To add player headshot to the bottom of each column, we will use the <code>element_nfl_headshot</code> function from the <code>nflplotR</code> package. Inside the <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> option, we use <code>element_nfl_headshot()</code> to replace the <code>axis_text.x()</code>. It is important to remember to use <code>passer_id</code> on the x-axis (rather than <code>passer_name</code> or something similar). The <code>nflplotR</code> package uses the <code>passer_id</code> to automatically pull the correct headshot for each player. Without including <code>passer_id</code> in the x-axis, the resulting headshots will be the “blank” NFL picture.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/geom_col_adding_headshots_c93a51b439d4f416cb0b0ed7ecece5b9">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">qb_thirddown_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">passer_id</span>, <span class="op">-</span><span class="va">qb_agg_pct</span><span class="op">)</span>,</span>
<span>                                     y <span class="op">=</span> <span class="va">qb_agg_pct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">qb_thirddown_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>           color <span class="op">=</span> <span class="va">qb_thirddown_data</span><span class="op">$</span><span class="va">team_color2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">with_outer_glow</span><span class="op">(</span><span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">passer</span><span class="op">)</span>,</span>
<span>                            position <span class="op">=</span> <span class="fu">position_stack</span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">.98</span><span class="op">)</span>,</span>
<span>                            angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>                            hjust <span class="op">=</span> <span class="fl">.98</span>,</span>
<span>                            color <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>                            family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                            fontface <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>                            size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>                  sigma <span class="op">=</span> <span class="fl">6</span>, expand <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">nflplotR</span><span class="fu">::</span><span class="fu"><a href="https://nflplotr.nflverse.com/reference/element.html">element_nfl_headshot</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"QB Aggressiveness on 3rd Down"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/geom_col_adding_headshots-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Using nflplotR to include headshots with the <code>element_nfl_headshots()</code> function</figcaption></figure>
</div>
</div>
</div>
<p>To complete the plot, we can add the <code>title</code>, <code>subtitle</code>, and <code>caption</code> using the <code>labs</code> function.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/geom_col_final_64357d16f94444a8f2116de11924bff5">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">qb_thirddown_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">passer_id</span>, <span class="op">-</span><span class="va">qb_agg_pct</span><span class="op">)</span>,</span>
<span>                                     y <span class="op">=</span> <span class="va">qb_agg_pct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">qb_thirddown_data</span><span class="op">$</span><span class="va">team_color</span>,</span>
<span>           color <span class="op">=</span> <span class="va">qb_thirddown_data</span><span class="op">$</span><span class="va">team_color2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">with_outer_glow</span><span class="op">(</span><span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">passer</span><span class="op">)</span>,</span>
<span>                            position <span class="op">=</span> <span class="fu">position_stack</span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">.98</span><span class="op">)</span>,</span>
<span>                            angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>                            hjust <span class="op">=</span> <span class="fl">.98</span>,</span>
<span>                            color <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>                            family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                            fontface <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>                            size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>                  sigma <span class="op">=</span> <span class="fl">6</span>, expand <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">nflplotR</span><span class="fu">::</span><span class="fu"><a href="https://nflplotr.nflverse.com/reference/element.html">element_nfl_headshot</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"QB Aggressiveness on 3rd Down"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"**QB Aggressiveness on Third Down**"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"*Numbers of Times Air Yards &gt;= Yards To Go*"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/geom_col_final-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding fishing touches to the <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> plot</figcaption></figure>
</div>
</div>
</div>
<p>As highlighted in the resulting plot, Tagovailoa was the only QB in the league to go above 60% in aggressiveness (Derek Carr was an even 60%). In this case, our domain knowledge of the NFL is important as we will recall that Tua was in concussion protocol for portions of the 2022 season. His aggressive percentage could be slightly inflated because of the fewer games compared to the other quarterbacks.</p>
<section id="an-alternative-geom_col-plot" class="level3" data-number="4.9.1"><h3 data-number="4.9.1" class="anchored" data-anchor-id="an-alternative-geom_col-plot">
<span class="header-section-number">4.9.1</span> An Alternative <code>geom_col</code> Plot</h3>
<p>The <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> plot is incredibly versatile, allowing you to create multiple types of visualizations. For example, we can use the data frame below, <code>epa_per_play</code>, to graph each teams average EPA per play during the 2022 regular season. However, rather than plot it in a standard column format like above, we will plot it in a “left-to-right” design with each team diverging from the 0.00 EPA per Play.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/epa-per-play-data_d3ba539791635f23c080ea96ca153da9">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">epa_per_play</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/epa-per-play"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> code required to output the visualization is quite similar to our above <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> plot for QB aggressiveness. There are several distinct differences, however.</p>
<ol type="1">
<li>We’ve included a <code>fill = if_else()</code> argument in <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code>. If a team has a positive EPA per play, the column for that team will be blue. If the team has a negative EPA per play, the column will be red.</li>
<li>The use of <code><a href="https://ggplot2.tidyverse.org/reference/scale_identity.html">scale_fill_identity()</a></code> is used because the data has already been scaled (by EPA per play) and already represents aesthetic values that are native to <code>ggplot2()</code>.</li>
<li>
<code>scale_y_discrete</code> is used because the y-axis is team names rather than a continuous variables. Moreover,<code>expand = c(.05, 0))</code> is included to make sure that the Chiefs and Texans logos are not clipped during the processing of the plot.</li>
</ol>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/epa-per-play-plot_2771123804d0d2d4900563586b1b519d">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">epa_per_play</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">epa_per_play</span>,</span>
<span>                                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">posteam</span>, <span class="va">epa_per_play</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">epa_per_play</span> <span class="op">&gt;=</span> <span class="fl">0</span>,</span>
<span>                              <span class="st">"#2c7bb6"</span>, <span class="st">"#d7181c"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_identity</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_image</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>image <span class="op">=</span> <span class="va">team_logo_wikipedia</span><span class="op">)</span>,</span>
<span>             asp <span class="op">=</span> <span class="fl">16</span><span class="op">/</span><span class="fl">9</span>, size <span class="op">=</span> <span class="fl">.035</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"EPA Per Play"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.05</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"**Expected Points Added per Play**"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"*2022 Regular Season*"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/epa-per-play-plot-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">An alternate way to design a <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> plot</figcaption></figure>
</div>
</div>
</div>
<p>It should not be a surprise that the Chiefs outperform - by a large margin - the rest of the NFL. The Texans and Colts, on the other hand, averaged -0.15 expected points added per play during the 2022 regular season.</p>
</section></section><section id="creating-a-geom_box-plot" class="level2" data-number="4.10"><h2 data-number="4.10" class="anchored" data-anchor-id="creating-a-geom_box-plot">
<span class="header-section-number">4.10</span> Creating a <code>geom_box</code> Plot</h2>
<p>We can create a <code>geom_box()</code> plot to examine the distribution of air yards for each playoff team from the 2022 season. A box plot is a suitable way to view distribution but to also view the “skewness” of a metric by also including the interquartile ranges, averages, and any outliers in the data.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/reading_airyards_plot_data_6b5da7b8dc75535477f2aef2cfe34a2c">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">playoff_airyards_plot</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/playoff-airyards"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot()</a></code> function includes one more argument - <code>color</code>. In this case, we have set the argument to <code>black</code>. We will also include the <code><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter()</a></code> function, which will plot each pass underneath the box plot. This is not a requirement for a box plot, but does add an additional level of aesthetics and detail to the final plot. Last, we use the <code>element_nfl_logo</code> function to place the respective team logo under each box plot.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/finished-box-plot_bb7ce8a41d00a76987f72c636cba7be5">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">playoff_airyards_plot</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">posteam</span>,</span>
<span>                                         y <span class="op">=</span> <span class="va">air_yards</span>,</span>
<span>                                         fill <span class="op">=</span> <span class="va">posteam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>color <span class="op">=</span> <span class="va">playoff_airyards_plot</span><span class="op">$</span><span class="va">team_color</span>, alpha <span class="op">=</span> <span class="fl">0.09</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nflplotR</span><span class="fu">::</span><span class="fu"><a href="https://nflplotr.nflverse.com/reference/scale_nfl.html">scale_fill_nfl</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Air Yards"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"**Distribution of Regular Season Air Yards**"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"*2022 NFL Playoff Teams*"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_nfl_logo</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/finished-box-plot-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">The finished <code>geom_boxplot</code> plot</figcaption></figure>
</div>
</div>
</div>
<p>In the visualization, each box plot represent the interquartile range (IQR) of air yards distribution for each team. The black line represents the median average, while the area below the black line is the lower quartile (Q1), or the 25th percentile, while the area above is the upper quartile (Q3), or the 75th percentile. The “whisker” coming from both ends of the box plot represent the minimum and maximum amounts (where the minimum is <code>Q1 - 1.5 * IQR</code> and the maximum is <code>Q3 + 1.5 * IQR</code>). The black dots above the whiskers indicate outliers.</p>
<p>Based on the results, the Miami Dolphins had the highest median air yards of the 2022 playoff teams while the New York Giants had the smallest spread (indicated by the 25th and 75th percentiles being closest to the median).</p>
</section><section id="creating-a-geom_ridges-plot" class="level2" data-number="4.11"><h2 data-number="4.11" class="anchored" data-anchor-id="creating-a-geom_ridges-plot">
<span class="header-section-number">4.11</span> Creating a <code>geom_ridges</code> Plot</h2>
<p>We can take the same idea used in the <code><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot()</a></code> graph to reformat it to be used in a <code>geom_ridges()</code> plot, which is another option to represent the distribution of a continuous variable.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/reading_in_ridges_data_7828a10c568f2fe19075eee848964758">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">playoff_airyards_ridges_plot</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/ay-ridges"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before creating the plot, we will create a function titled <code>meansd</code> that will assist in including lines within the <code>geom_ridges()</code> to show the mean and standard deviation for each team.</p>
<p>The <code>meansd</code> function is included in the <code>geom_density_ridges()</code> arguments. We want to show <code>quantile_lines</code>, so we provide <code>meansd</code> to the <code>quantile_fun</code> argument and then set the <code>color</code> of the quantile lines.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/finished-geom-ridges_57da0e3cdbcec6390014926b535f8bdf">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">### creating function to add SD, mean, and mean + sd</span></span>
<span><span class="va">meansd</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mean</span> <span class="op">-</span> <span class="va">sd</span>, <span class="va">mean</span>, <span class="va">mean</span> <span class="op">+</span> <span class="va">sd</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">### plotting the data</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">playoff_airyards_ridges_plot</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">air_yards</span>,</span>
<span>                                                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">posteam</span>,</span>
<span>                                                            <span class="op">-</span><span class="va">air_yards</span><span class="op">)</span>,</span>
<span>                                                fill <span class="op">=</span> <span class="va">posteam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density_ridges</span><span class="op">(</span>quantile_lines <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                      quantile_fun <span class="op">=</span> <span class="va">meansd</span>,</span>
<span>                      color <span class="op">=</span> <span class="st">"#d0d0d0"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nflplotR</span><span class="fu">::</span><span class="fu"><a href="https://nflplotr.nflverse.com/reference/scale_nfl.html">scale_fill_nfl</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Air Yards"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"**Distribution of Regular Season Air Yards**"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"*2022 NFL Playoff Teams*"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_nfl_logo</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/finished-geom-ridges-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">The finished <code>geom_ridges()</code> plot</figcaption></figure>
</div>
</div>
</div>
</section><section id="creating-a-geom_violin-plot" class="level2" data-number="4.12"><h2 data-number="4.12" class="anchored" data-anchor-id="creating-a-geom_violin-plot">
<span class="header-section-number">4.12</span> Creating a <code>geom_violin</code> Plot</h2>
<p></p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/reading_in_violin_data_d0b18e6b28e7279898056f00f7790e70">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">yards_gained_compared</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/yards_gained"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/violin-plot-completed_5d073e1860aea2a7015b765d36411269">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">custom_labeller</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">variable</span>, <span class="va">value</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">new_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1st Down"</span>, <span class="st">"2nd Down"</span>, <span class="st">"3rd Down"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">new_labels</span><span class="op">[</span><span class="va">value</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yards_gained_compared</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">posteam</span>,</span>
<span>                                         y <span class="op">=</span> <span class="va">yards_gained</span>,</span>
<span>                                         group <span class="op">=</span> <span class="va">posteam</span>,</span>
<span>                                         fill <span class="op">=</span> <span class="va">posteam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_violin</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span>fun.y <span class="op">=</span> <span class="va">mean</span>, fun.ymin <span class="op">=</span> <span class="va">mean</span>, fun.ymax <span class="op">=</span> <span class="va">mean</span>,</span>
<span>               geom <span class="op">=</span> <span class="st">"crossbar"</span>,</span>
<span>               width <span class="op">=</span> <span class="fl">0.50</span>,</span>
<span>               position <span class="op">=</span> <span class="fu">position_dodge</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">down</span>, labeller <span class="op">=</span> <span class="fu">labeller</span><span class="op">(</span>down <span class="op">=</span> <span class="va">custom_labeller</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#E31837"</span>, <span class="st">"#013369"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Average Yards Gained"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"*Averaged Yards Gained per Down*"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"**KC Chiefs vs. NFL: 2022 Regular Season**"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">nflplotR</span><span class="fu">::</span><span class="fu"><a href="https://nflplotr.nflverse.com/reference/element.html">element_nfl_logo</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>        strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Roboto"</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#f7f7f7"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/violin-plot-completed-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">The finished <code><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin()</a></code> plot</figcaption></figure>
</div>
</div>
</div>
</section><section id="creating-a-geom_histogram-plot" class="level2" data-number="4.13"><h2 data-number="4.13" class="anchored" data-anchor-id="creating-a-geom_histogram-plot">
<span class="header-section-number">4.13</span> Creating a <code>geom_histogram</code> Plot</h2>
<p></p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/reading_in_histogram_data_d3d74d6ce4db11957631577aeb2c84c3">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">def_yards_allowed</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/def-yards"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/histrogram-plot-completed_ea7e0ca21248d775445396219d74cca9">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">def_yards_allowed</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">yards_allowed</span>, fill <span class="op">=</span> <span class="va">defteam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nflplotR</span><span class="fu">::</span><span class="fu"><a href="https://nflplotr.nflverse.com/reference/scale_nfl.html">scale_fill_nfl</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"primary"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">500</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">defteam</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu">element_nfl_wordmark</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#F7F7F7"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Defensive Yards Allowed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Total Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"*Histogram of Defensive Yards Allowed*"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"**2022 NFL Regular Season**"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/histrogram-plot-completed-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">The finished <code>geom_histgram()</code> plot</figcaption></figure>
</div>
</div>
</div>
</section><section id="saving-your-ggplot2-creations" class="level2" data-number="4.14"><h2 data-number="4.14" class="anchored" data-anchor-id="saving-your-ggplot2-creations">
<span class="header-section-number">4.14</span> Saving Your <code>ggplot2</code> Creations</h2>
<p>The most convenient way to save your finished plot is with the <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave()</a></code> function, which will save the last plot created. The function accepts a multitude of different arguments, including <code>filename</code>, <code>device</code>, <code>path</code>, <code>scale</code>, <code>width</code>, <code>height</code>, and <code>dpi</code>.</p>
<p>In most cases, you will be able to save your plot using just the <code>filename</code> and <code>dpi</code> arguments.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/example-gg-save_db21f21469d603e42e5b5e017d4c26da">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"this-is-your-filename.png"</span>, dpi <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the above example, the plot will be outputted in <code>.png</code> format into your current working directory (you can see where the plot will be saved by using <code><a href="https://rdrr.io/r/base/getwd.html">getwd()</a></code>). The image <code>dpi</code> - or “dots per inch” - ultimately controls the plot’s resolution. A higher number will allow you to increase the size the image, but will also increase the size of the file itself. I find that using a <code>dpi</code> between 300 and 400 is suitable for nearly all plots.</p>
</section><section id="advanced-headshots-method" class="level2" data-number="4.15"><h2 data-number="4.15" class="anchored" data-anchor-id="advanced-headshots-method">
<span class="header-section-number">4.15</span> Advanced Headshots Method</h2>
<p>The ability to include player headshots onto plots is an outstanding addition to the NFL analytics universe. However, the headshots themselves quite often have “harsh” aesthetics in that the image is cut off at the shoulders and, as a result, can result in plots where the shoulders just seem to “fall off” into the abyss of the plot itself.</p>
<p>To correct this, we can use several different package to create circular croppings of the of the individual headshot images and then wrap the player’s name around the image itself.</p>
<p>To showcase the process, let’s create a data frame titled <code>complete_wr_airyards</code> with the below code:</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/reading_headshot_csv_cc90da8bd3f335bc99e5ad1bafc2e862">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">complete_wr_airyards</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/complete_ay"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To begin the process, we create a data frame called <code>crop_circles_data</code> that includes just one observation for each wide receive that has the <code>receiver_id</code> and <code>headshot_url</code> variables. After, we create a new column in <code>crop_circles_data</code> called <code>circle</code> and then use the <code>circle_crop</code> function from the <code>cropcircles</code> package to automatically crop each player’s headshot into a uniform circle. The resulting image is saved locally on your device. Last, since we no longer need the <code>headshot_url</code> information, we drop that from the <code>crop_circles_data</code> data frame.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/cropcircles_on_headshots_1b88e231482a2e6fa81403c47a8b1d28">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crop_circles_data</span> <span class="op">&lt;-</span> <span class="va">complete_wr_airyards</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">receiver_id</span>, <span class="va">headshot_url</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">receiver_id</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">crop_circles_data</span> <span class="op">&lt;-</span> <span class="va">crop_circles_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>circle <span class="op">=</span> <span class="fu">cropcircles</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cropcircles/man/circle_crop.html">circle_crop</a></span><span class="op">(</span><span class="va">headshot_url</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">crop_circles_data</span> <span class="op">&lt;-</span> <span class="va">crop_circles_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">receiver_id</span>, <span class="va">circle</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The next step, which is a modified version of an approach used by <a href="https://twitter.com/tanya_shapiro">Tanya Shapiro</a>, is multifaceted. We first use the <code>magick</code> package to create a composite of the image and place a white background behind the circular cropped headshot.</p>
<p>We then create a function called <code>plot_image_label</code> that will wrap each player’s name around the top of the circular headshot and then proceed with producing the images with the names wrapped using <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/circle_image_border_28492af620aa52a5f2992816e9edbd7b">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">border</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">im</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ii</span> <span class="op">&lt;-</span> <span class="fu">magick</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/magick/reference/attributes.html">image_info</a></span><span class="op">(</span><span class="va">im</span><span class="op">)</span></span>
<span>  <span class="va">ii_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">ii</span><span class="op">$</span><span class="va">width</span>, <span class="va">ii</span><span class="op">$</span><span class="va">height</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">img</span> <span class="op">&lt;-</span> <span class="fu">image_blank</span><span class="op">(</span>width <span class="op">=</span> <span class="va">ii_min</span>, height <span class="op">=</span> <span class="va">ii_min</span>, color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>  <span class="va">drawing</span> <span class="op">&lt;-</span> <span class="fu">image_draw</span><span class="op">(</span><span class="va">img</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/symbols.html">symbols</a></span><span class="op">(</span><span class="va">ii_min</span><span class="op">/</span><span class="fl">2</span>, <span class="va">ii_min</span><span class="op">/</span><span class="fl">2</span>, circles <span class="op">=</span> <span class="va">ii_min</span><span class="op">/</span><span class="fl">2.2</span>,</span>
<span>          bg <span class="op">=</span> <span class="st">"white"</span>, inches <span class="op">=</span> <span class="cn">FALSE</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="fu">image_composite</span><span class="op">(</span><span class="fu">image_scale</span><span class="op">(</span><span class="va">drawing</span>, <span class="st">"x430"</span><span class="op">)</span>,</span>
<span>                      <span class="fu">image_scale</span><span class="op">(</span><span class="va">im</span>, <span class="st">"x400"</span><span class="op">)</span>, offset <span class="op">=</span> <span class="st">"+15+15"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">### now let's add the player's name and wrap it around the circle</span></span>
<span><span class="va">plot_image_label</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">image</span>,</span>
<span>                           <span class="va">label</span>,</span>
<span>                           <span class="va">font_color</span><span class="op">=</span><span class="st">"black"</span>, </span>
<span>                           <span class="va">top_bottom</span><span class="op">=</span><span class="st">"top"</span>,</span>
<span>                           <span class="va">hjust</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">*</span> <span class="va">pi</span></span>
<span>  </span>
<span>  <span class="co">### set up data</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">top_bottom</span><span class="op">==</span><span class="st">"top"</span><span class="op">)</span><span class="op">{</span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>,y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">top_bottom</span><span class="op">==</span><span class="st">"bottom"</span><span class="op">)</span><span class="op">{</span><span class="va">data</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>,y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">*</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">### set up data   ### the `vjust` option here changes how close name is</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">top_bottom</span><span class="op">==</span><span class="st">"top"</span><span class="op">)</span><span class="op">{</span><span class="va">vjust</span><span class="op">=</span><span class="fl">0.5</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">top_bottom</span><span class="op">==</span><span class="st">"bottom"</span><span class="op">)</span><span class="op">{</span><span class="va">vjust</span><span class="op">=</span><span class="op">-</span><span class="fl">0.1</span><span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">### set up data</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">top_bottom</span><span class="op">==</span><span class="st">"top"</span><span class="op">)</span><span class="op">{</span><span class="va">ymax</span><span class="op">=</span><span class="fl">1.2</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">top_bottom</span><span class="op">==</span><span class="st">"bottom"</span><span class="op">)</span><span class="op">{</span><span class="va">ymax</span><span class="op">=</span><span class="fl">0.9</span><span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">### set up data</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">top_bottom</span><span class="op">==</span><span class="st">"top"</span><span class="op">)</span><span class="op">{</span><span class="va">ymin</span><span class="op">=</span><span class="op">-</span><span class="fl">0.9</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">top_bottom</span><span class="op">==</span><span class="st">"bottom"</span><span class="op">)</span><span class="op">{</span><span class="va">ymin</span><span class="op">=</span><span class="op">-</span><span class="fl">1.2</span><span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">### now taking the text an adding it into a ggplot with the circle</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_image</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">0</span>, image <span class="op">=</span> <span class="va">image</span><span class="op">)</span>, asp<span class="op">=</span><span class="fl">2.4</span><span class="op">/</span><span class="fl">2.1</span>,</span>
<span>               size<span class="op">=</span><span class="fl">.7</span>, image_fun<span class="op">=</span><span class="va">border</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_x_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.2</span>, <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">scale_y_continuous</span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ymin</span>, <span class="va">ymax</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_textpath</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">toupper</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  linecolor<span class="op">=</span><span class="cn">NA</span>, color<span class="op">=</span><span class="va">font_color</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">16</span>,  fontface<span class="op">=</span><span class="st">"bold"</span>,</span>
<span>                  vjust <span class="op">=</span> <span class="va">vjust</span>, hjust<span class="op">=</span><span class="va">hjust</span>, family <span class="op">=</span> <span class="st">"Roboto"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After the process finishes running (it may take a while depending on your computing power), we create a new column titled <code>new_image_path</code> and use <code>paste0</code> to copy the <code>receiver_id</code> for each player and add “.png” on the end.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/creating_new_path_7bd18fb8eeab2b17fa767c5fbc16f268">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crop_circles_data</span> <span class="op">&lt;-</span> <span class="va">crop_circles_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>new_image_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">receiver_id</span>, <span class="st">".png"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then loop our <code>crop_cirlces_data</code> function back over the images and save them into a new images folder on our computer.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/looping_over_images_25273b7065886fa8d263d15ea3503025">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">crop_circles_data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">pos</span> <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="va">hjust</span> <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="va">path</span> <span class="op">=</span> <span class="va">crop_circles_data</span><span class="op">$</span><span class="va">new_image_path</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">plot</span> <span class="op">=</span> <span class="fu">plot_image_label</span><span class="op">(</span>image <span class="op">=</span> <span class="va">crop_circles_data</span><span class="op">$</span><span class="va">circle</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>                          label <span class="op">=</span> <span class="va">crop_circles_data</span><span class="op">$</span><span class="va">receiver</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>                          font_color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>                          top_bottom <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>                          hjust <span class="op">=</span> <span class="va">hjust</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">ggsave</span><span class="op">(</span>filename <span class="op">=</span> <span class="fu">glue</span><span class="op">(</span><span class="st">"./images/circle_headshots/{path}"</span><span class="op">)</span>,</span>
<span>         plot<span class="op">=</span><span class="va">plot</span>, height<span class="op">=</span><span class="fl">3.95</span>, width<span class="op">=</span><span class="fl">4.5</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>If RStudio happens to stop outputting <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> visualizations at this point, please run <code><a href="https://rdrr.io/r/grDevices/dev.html">dev.off()</a></code>.</p>
</div>
</div>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/adding_image_path_9e0b38805875ab5afd71b5524d32305a">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crop_circles_data</span> <span class="op">&lt;-</span> <span class="va">crop_circles_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>image <span class="op">=</span> <span class="fu">glue</span><span class="op">(</span><span class="st">"./images/circle_headshots/{new_image_path}"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now take our new cropped headshots and bring them into a visualization created with <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/finished-kernel-density_12505a6b29378dde966dcf3585e2795f">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">complete_wr_ay</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">air_yards</span>, fill <span class="op">=</span> <span class="va">posteam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nflplotR</span><span class="fu">::</span><span class="fu"><a href="https://nflplotr.nflverse.com/reference/scale_nfl.html">scale_fill_nfl</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_image</span><span class="op">(</span>data <span class="op">=</span> <span class="va">complete_wr_ay</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">40</span>, y <span class="op">=</span> <span class="fl">0.04</span>,</span>
<span>                                        image <span class="op">=</span> <span class="va">image</span><span class="op">)</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">receiver_id</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">nfl_analytics_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.text<span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Air Yards"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"**Top Ten WRs in Total Air Yards**"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"*Density Plot of How They Were Earned*"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">       **Brad J. Congelio**"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="04-nfl-analytics-visualization_files/figure-html/finished-kernel-density-1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Using <code>magick</code> to create circular headshots for plots</figcaption></figure>
</div>
</div>
</div>
</section><section id="creating-tables-with-gt-and-gtextras" class="level2" data-number="4.16"><h2 data-number="4.16" class="anchored" data-anchor-id="creating-tables-with-gt-and-gtextras">
<span class="header-section-number">4.16</span> Creating Tables with <code>gt</code> and <code>gtExtras</code>
</h2>
<p>In some instances, you may find that a plot produced by <code>ggplot2</code> is not the best medium in which to display your data. In that case, you may want to turn to use the <code>gt</code> package (and the accompanying add-on from Thomas Mock, <code>gtExtras</code>). Much like <code>ggplot2</code> stands for the “grammar of graphics”, the <code>gt</code> package is short for the “grammar of tables.” Taking a data frame into a <code>gt</code> table is as simple as piping into the <code><a href="https://gt.rstudio.com/reference/gt.html">gt()</a></code> function, but the end result will likely not be visually pleasing. To make the necessary adjustments, you will need to begin making changes to the output by altering the core parts of a <code>gt</code> table: the table header, the stub and stub head, the column labels, the table body, and the table footer.</p>
<p>To provide a walk through of this process, let’s read in prepared data that examines the top ten average completion percentage over expected for those attempts in a pure passing situation (that is, plays that have a predictive probability of 70% or greater of being a passing attempt).</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/reading-in-pure-cpoe_c5b511c6ad8a745f12bbcb6f66332703">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pure_cpoe</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/pure-cpoe"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As mentioned, we can quickly take the data and turn it into a <code>gt</code> table by piping it directly into the package’s core function. <strong>Please note that we are using the <code><a href="https://gt.rstudio.com/reference/cols_hide.html">cols_hide()</a></code></strong> <strong>function to remove both the <code>headshot</code> and <code>team_logo_wikipedia</code> variables at first, as including them at this point in the design process results in long strings of URL data that make it difficult to grasp what the current table looks like.</strong></p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/pure-cpoe-pipe_63986f03cc8ed19462243e6e86424ba5">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pure_cpoe</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gt</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_hide</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">headshot</span>, <span class="va">team_logo_wikipedia</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="okgzwakhwx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#okgzwakhwx .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#okgzwakhwx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#okgzwakhwx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#okgzwakhwx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#okgzwakhwx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#okgzwakhwx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#okgzwakhwx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#okgzwakhwx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#okgzwakhwx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#okgzwakhwx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#okgzwakhwx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#okgzwakhwx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#okgzwakhwx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#okgzwakhwx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#okgzwakhwx .gt_from_md > :first-child {
  margin-top: 0;
}

#okgzwakhwx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#okgzwakhwx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#okgzwakhwx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#okgzwakhwx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#okgzwakhwx .gt_row_group_first td {
  border-top-width: 2px;
}

#okgzwakhwx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#okgzwakhwx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#okgzwakhwx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#okgzwakhwx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#okgzwakhwx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#okgzwakhwx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#okgzwakhwx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#okgzwakhwx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#okgzwakhwx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#okgzwakhwx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#okgzwakhwx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#okgzwakhwx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#okgzwakhwx .gt_left {
  text-align: left;
}

#okgzwakhwx .gt_center {
  text-align: center;
}

#okgzwakhwx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#okgzwakhwx .gt_font_normal {
  font-weight: normal;
}

#okgzwakhwx .gt_font_bold {
  font-weight: bold;
}

#okgzwakhwx .gt_font_italic {
  font-style: italic;
}

#okgzwakhwx .gt_super {
  font-size: 65%;
}

#okgzwakhwx .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#okgzwakhwx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#okgzwakhwx .gt_indent_1 {
  text-indent: 5px;
}

#okgzwakhwx .gt_indent_2 {
  text-indent: 10px;
}

#okgzwakhwx .gt_indent_3 {
  text-indent: 15px;
}

#okgzwakhwx .gt_indent_4 {
  text-indent: 20px;
}

#okgzwakhwx .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings"><tr class="header">
<th id="season" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">season</th>
<th id="passer" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">passer</th>
<th id="total_attempts" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">total_attempts</th>
<th id="mean_cpoe" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean_cpoe</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="season">2013</td>
<td class="gt_row gt_left" headers="passer">P.Rivers</td>
<td class="gt_row gt_right" headers="total_attempts">291</td>
<td class="gt_row gt_right" headers="mean_cpoe">10.893818</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="season">2018</td>
<td class="gt_row gt_left" headers="passer">P.Mahomes</td>
<td class="gt_row gt_right" headers="total_attempts">261</td>
<td class="gt_row gt_right" headers="mean_cpoe">9.293220</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="season">2020</td>
<td class="gt_row gt_left" headers="passer">A.Rodgers</td>
<td class="gt_row gt_right" headers="total_attempts">242</td>
<td class="gt_row gt_right" headers="mean_cpoe">8.573572</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="season">2013</td>
<td class="gt_row gt_left" headers="passer">R.Wilson</td>
<td class="gt_row gt_right" headers="total_attempts">231</td>
<td class="gt_row gt_right" headers="mean_cpoe">8.473162</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="season">2018</td>
<td class="gt_row gt_left" headers="passer">R.Wilson</td>
<td class="gt_row gt_right" headers="total_attempts">277</td>
<td class="gt_row gt_right" headers="mean_cpoe">8.448647</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="season">2011</td>
<td class="gt_row gt_left" headers="passer">D.Brees</td>
<td class="gt_row gt_right" headers="total_attempts">311</td>
<td class="gt_row gt_right" headers="mean_cpoe">8.285040</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="season">2018</td>
<td class="gt_row gt_left" headers="passer">M.Ryan</td>
<td class="gt_row gt_right" headers="total_attempts">315</td>
<td class="gt_row gt_right" headers="mean_cpoe">8.233131</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="season">2012</td>
<td class="gt_row gt_left" headers="passer">M.Ryan</td>
<td class="gt_row gt_right" headers="total_attempts">303</td>
<td class="gt_row gt_right" headers="mean_cpoe">8.108120</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="season">2015</td>
<td class="gt_row gt_left" headers="passer">R.Wilson</td>
<td class="gt_row gt_right" headers="total_attempts">279</td>
<td class="gt_row gt_right" headers="mean_cpoe">7.515386</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="season">2021</td>
<td class="gt_row gt_left" headers="passer">J.Burrow</td>
<td class="gt_row gt_right" headers="total_attempts">343</td>
<td class="gt_row gt_right" headers="mean_cpoe">7.117319</td>
</tr>
</tbody>
</table>
</div>
<p>Using the <code>dplyr</code> to pipe the data frame directly into the <code>gt</code> package</p>
</div>
</div>
<p>The output is not terrible, but it does not include the headshot and team logo information yet. The output is realistically just the data frame outputted into a different format. Let’s begin making incremental changes to the table by first adding a title and subtitle, using Markdown (<code><a href="https://gt.rstudio.com/reference/md.html">md()</a></code>) to provide bold and italicized styling to each.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/pure-cpoe-tab-header_fb313510d12e3da78bf9ef4adab047f6">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pure_cpoe</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gt</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_hide</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">headshot</span>, <span class="va">team_logo_wikipedia</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tab_header</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="fu">md</span><span class="op">(</span><span class="st">"**Average CPOE in Pure Passing Situations**"</span><span class="op">)</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu">md</span><span class="op">(</span><span class="st">"*2010-2022  |  Pure Passing is &gt;= 70% Chance of Pass Attempt*"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="njkfgdukdi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#njkfgdukdi) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#njkfgdukdi) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#njkfgdukdi) .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

:where(#njkfgdukdi) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#njkfgdukdi) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#njkfgdukdi) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#njkfgdukdi) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#njkfgdukdi) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#njkfgdukdi) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#njkfgdukdi) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#njkfgdukdi) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#njkfgdukdi) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#njkfgdukdi) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

:where(#njkfgdukdi) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#njkfgdukdi) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#njkfgdukdi) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#njkfgdukdi) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#njkfgdukdi) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#njkfgdukdi) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#njkfgdukdi) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#njkfgdukdi) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#njkfgdukdi) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#njkfgdukdi) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#njkfgdukdi) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#njkfgdukdi) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#njkfgdukdi) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#njkfgdukdi) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#njkfgdukdi) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#njkfgdukdi) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#njkfgdukdi) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#njkfgdukdi) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#njkfgdukdi) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#njkfgdukdi) .gt_left {
  text-align: left;
}

:where(#njkfgdukdi) .gt_center {
  text-align: center;
}

:where(#njkfgdukdi) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#njkfgdukdi) .gt_font_normal {
  font-weight: normal;
}

:where(#njkfgdukdi) .gt_font_bold {
  font-weight: bold;
}

:where(#njkfgdukdi) .gt_font_italic {
  font-style: italic;
}

:where(#njkfgdukdi) .gt_super {
  font-size: 65%;
}

:where(#njkfgdukdi) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#njkfgdukdi) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#njkfgdukdi) .gt_indent_1 {
  text-indent: 5px;
}

:where(#njkfgdukdi) .gt_indent_2 {
  text-indent: 10px;
}

:where(#njkfgdukdi) .gt_indent_3 {
  text-indent: 15px;
}

:where(#njkfgdukdi) .gt_indent_4 {
  text-indent: 20px;
}

:where(#njkfgdukdi) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
<thead class="gt_header">
<tr>
<td colspan="4" class="gt_heading gt_title gt_font_normal" style=""><strong>Average CPOE in Pure Passing Situations</strong></td>
    </tr>
<tr>
<td colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style=""><em>2010-2022  |  Pure Passing is &gt;= 70% Chance of Pass Attempt</em></td>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="season">season</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="passer">passer</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="total_attempts">total_attempts</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="mean_cpoe">mean_cpoe</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers="season" class="gt_row gt_right">2013</td>
<td headers="passer" class="gt_row gt_left">P.Rivers</td>
<td headers="total_attempts" class="gt_row gt_right">291</td>
<td headers="mean_cpoe" class="gt_row gt_right">10.893818</td>
</tr>
<tr>
<td headers="season" class="gt_row gt_right">2018</td>
<td headers="passer" class="gt_row gt_left">P.Mahomes</td>
<td headers="total_attempts" class="gt_row gt_right">261</td>
<td headers="mean_cpoe" class="gt_row gt_right">9.293220</td>
</tr>
<tr>
<td headers="season" class="gt_row gt_right">2020</td>
<td headers="passer" class="gt_row gt_left">A.Rodgers</td>
<td headers="total_attempts" class="gt_row gt_right">242</td>
<td headers="mean_cpoe" class="gt_row gt_right">8.573572</td>
</tr>
<tr>
<td headers="season" class="gt_row gt_right">2013</td>
<td headers="passer" class="gt_row gt_left">R.Wilson</td>
<td headers="total_attempts" class="gt_row gt_right">231</td>
<td headers="mean_cpoe" class="gt_row gt_right">8.473162</td>
</tr>
<tr>
<td headers="season" class="gt_row gt_right">2018</td>
<td headers="passer" class="gt_row gt_left">R.Wilson</td>
<td headers="total_attempts" class="gt_row gt_right">277</td>
<td headers="mean_cpoe" class="gt_row gt_right">8.448647</td>
</tr>
<tr>
<td headers="season" class="gt_row gt_right">2011</td>
<td headers="passer" class="gt_row gt_left">D.Brees</td>
<td headers="total_attempts" class="gt_row gt_right">311</td>
<td headers="mean_cpoe" class="gt_row gt_right">8.285040</td>
</tr>
<tr>
<td headers="season" class="gt_row gt_right">2018</td>
<td headers="passer" class="gt_row gt_left">M.Ryan</td>
<td headers="total_attempts" class="gt_row gt_right">315</td>
<td headers="mean_cpoe" class="gt_row gt_right">8.233131</td>
</tr>
<tr>
<td headers="season" class="gt_row gt_right">2012</td>
<td headers="passer" class="gt_row gt_left">M.Ryan</td>
<td headers="total_attempts" class="gt_row gt_right">303</td>
<td headers="mean_cpoe" class="gt_row gt_right">8.108120</td>
</tr>
<tr>
<td headers="season" class="gt_row gt_right">2015</td>
<td headers="passer" class="gt_row gt_left">R.Wilson</td>
<td headers="total_attempts" class="gt_row gt_right">279</td>
<td headers="mean_cpoe" class="gt_row gt_right">7.515386</td>
</tr>
<tr>
<td headers="season" class="gt_row gt_right">2021</td>
<td headers="passer" class="gt_row gt_left">J.Burrow</td>
<td headers="total_attempts" class="gt_row gt_right">343</td>
<td headers="mean_cpoe" class="gt_row gt_right">7.117319</td>
</tr>
</tbody>
</table>
</div>
<p>Adding a title and subtitle to the Pure CPOE table</p>
</div>
</div>
<p>After adding the title and subtitle to the top of the table, we can continue to remove the <code>team_logo_wikipedia</code> information using the <code><a href="https://gt.rstudio.com/reference/cols_hide.html">cols_hide()</a></code> function and then place the player pictures into the table using the <code>gt_img_rows()</code> function from the <code>gtExtras</code> package.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/remove-wiki-add-photo_c6b07e7a924e883fca7dc2584be1ac70">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pure_cpoe</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gt</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_hide</span><span class="op">(</span><span class="va">team_logo_wikipedia</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tab_header</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="fu">md</span><span class="op">(</span><span class="st">"**Average CPOE in Pure Passing Situations**"</span><span class="op">)</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu">md</span><span class="op">(</span><span class="st">"*2010-2022  |  Pure Passing is &gt;= 70%</span></span>
<span><span class="st">                  Chance of Pass Attempt*"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gt_img_rows</span><span class="op">(</span><span class="va">headshot</span>, height <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/show-gt-table-1_1e27e03f4531d21fe569d4d451db085f">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/gt_table_1.png" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Adding player headshots to the table using <code>gt_img_rows</code> from <code>gtExtras</code></figcaption></figure>
</div>
</div>
</div>
<p>That is considerably better. But it can be even better. For example, the column labels are still in the format from the <code>pure_cpoe</code> data frame with underscores and issues with capitalized letters. Let’s make these grammatical corrections using <code><a href="https://gt.rstudio.com/reference/cols_label.html">cols_label()</a></code> . As well, let’s move the <code>passer</code> column to the far left and use the <code><a href="https://gt.rstudio.com/reference/tab_stubhead.html">tab_stubhead()</a></code> function, allowing us to position the names to the left of the column labels and with a vertical line separating them from the other data being presented. This also requires placing <code>rowname_col = "passer"</code> into the call to the <code><a href="https://gt.rstudio.com/reference/gt.html">gt()</a></code> package.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/add-stub-head-label_a41a93772404ec5cbf19f0dc18406397">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pure_cpoe</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gt</span><span class="op">(</span>rowname_col <span class="op">=</span> <span class="st">"passer"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_hide</span><span class="op">(</span><span class="va">team_logo_wikipedia</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tab_header</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="fu">md</span><span class="op">(</span><span class="st">"**Average CPOE in Pure Passing Situations**"</span><span class="op">)</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu">md</span><span class="op">(</span><span class="st">"*2010-2022  |  Pure Passing is &gt;= 70%</span></span>
<span><span class="st">                  Chance of Pass Attempt*"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tab_stubhead</span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Quarterback"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gt_img_rows</span><span class="op">(</span><span class="va">headshot</span>, height <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_label</span><span class="op">(</span></span>
<span>    passer <span class="op">=</span> <span class="st">"Quarterback"</span>,</span>
<span>    headshot <span class="op">=</span> <span class="st">""</span>,</span>
<span>    season <span class="op">=</span> <span class="st">"Season"</span>,</span>
<span>    total_attempts <span class="op">=</span> <span class="st">"Attempts"</span>,</span>
<span>    mean_cpoe <span class="op">=</span> <span class="st">"Mean CPOE"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/show_gt_table_2_d6c9dcc584b726c2f2bf31adf3f04456">
<div class="cell-output-display">
<p><img src="images/gt_table_2.png" style="width:95.0%;height:95.0%"></p>
</div>
</div>
<p>We are almost there. But, it looks strange to have the player’s picture so far removed from their name. Let’s place the <code>headshot</code> column as the first column and, while we are at it, use the <code><a href="https://gt.rstudio.com/reference/cols_align.html">cols_align()</a></code> function to center align the <code>passer</code> and <code>total_attempts</code> columns.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/moving-images-and-align_fd48597baa50e0073f64acb95df291f9">
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pure_cpoe</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gt</span><span class="op">(</span>rowname_col <span class="op">=</span> <span class="st">"passer"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_hide</span><span class="op">(</span><span class="va">team_logo_wikipedia</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tab_header</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="fu">md</span><span class="op">(</span><span class="st">"**Average CPOE in Pure Passing Situations**"</span><span class="op">)</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu">md</span><span class="op">(</span><span class="st">"*2010-2022  |  Pure Passing is &gt;= 70%</span></span>
<span><span class="st">                  Chance of Pass Attempt*"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tab_stubhead</span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Quarterback"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gtExtras</span><span class="fu">::</span><span class="fu"><a href="https://jthomasmock.github.io/gtExtras/reference/gt_img_rows.html">gt_img_rows</a></span><span class="op">(</span><span class="va">headshot</span>, height <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_label</span><span class="op">(</span></span>
<span>    passer <span class="op">=</span> <span class="st">"Quarterback"</span>,</span>
<span>    headshot <span class="op">=</span> <span class="st">""</span>,</span>
<span>    season <span class="op">=</span> <span class="st">"Season"</span>,</span>
<span>    total_attempts <span class="op">=</span> <span class="st">"Attempts"</span>,</span>
<span>    mean_cpoe <span class="op">=</span> <span class="st">"Mean CPOE"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_move_to_start</span><span class="op">(</span></span>
<span>    columns <span class="op">=</span> <span class="va">headshot</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_align</span><span class="op">(</span>align <span class="op">=</span> <span class="st">"center"</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"passer"</span>, <span class="st">"total_attempts"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/show_gt_table_3_e77a56b472014b0b3b06291f4d849685">
<div class="cell-output-display">
<p><img src="images/gt_table_3.png" style="width:95.0%;height:95.0%"></p>
</div>
</div>
<p>As one last visual enhancement, we will use the <code>gt_color_box()</code> function from <code>gtExtras</code> to replace the values in mean_cpoe with colorboxes that are similar to those used in data visualizations on Pro Football Focus.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/adding-color-boxes_b51a4e60ab7e8c2023c119e6a160481a">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pure_cpoe</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gt</span><span class="op">(</span>rowname_col <span class="op">=</span> <span class="st">"passer"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_hide</span><span class="op">(</span><span class="va">team_logo_wikipedia</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tab_header</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="fu">md</span><span class="op">(</span><span class="st">"**Average CPOE in Pure Passing Situations**"</span><span class="op">)</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu">md</span><span class="op">(</span><span class="st">"*2010-2022  |  Pure Passing is &gt;= 70%</span></span>
<span><span class="st">                  Chance of Pass Attempt*"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tab_stubhead</span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Quarterback"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gt_img_rows</span><span class="op">(</span><span class="va">headshot</span>, height <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_label</span><span class="op">(</span></span>
<span>    passer <span class="op">=</span> <span class="st">"Quarterback"</span>,</span>
<span>    headshot <span class="op">=</span> <span class="st">""</span>,</span>
<span>    season <span class="op">=</span> <span class="st">"Season"</span>,</span>
<span>    total_attempts <span class="op">=</span> <span class="st">"Attempts"</span>,</span>
<span>    mean_cpoe <span class="op">=</span> <span class="st">"Mean CPOE"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_move_to_start</span><span class="op">(</span></span>
<span>    columns <span class="op">=</span> <span class="va">headshot</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_align</span><span class="op">(</span>align <span class="op">=</span> <span class="st">"center"</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"passer"</span>, <span class="st">"total_attempts"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gt_color_box</span><span class="op">(</span><span class="va">mean_cpoe</span>, domain <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">11</span>,</span>
<span>               palette <span class="op">=</span> <span class="st">"ggsci::blue_material"</span>, accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/show_gt_table_4_4c9d596924f6227b126efdb48c3dadc0">
<div class="cell-output-display">
<p><img src="images/gt_table_4.png" style="width:95.0%;height:95.0%"></p>
</div>
</div>
<p>It is important to include the <code>accuracy = 0.01</code> within the <code>gt_color_box()</code>, otherwise the output of the table includes just whole numbers. At this point, the table is complete all for adding a caption at the bottom and using one of the formatted themes from <code>gtExtras</code> (I am partial to <code>gt_theme_538</code>).</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/caption-and-theme_a40896a6e97d7ee2e8a994c5deb554a4">
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pure_cpoe</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gt</span><span class="op">(</span>rowname_col <span class="op">=</span> <span class="st">"passer"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_hide</span><span class="op">(</span><span class="va">team_logo_wikipedia</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tab_header</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="fu">md</span><span class="op">(</span><span class="st">"**Average CPOE in Pure Passing Situations**"</span><span class="op">)</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu">md</span><span class="op">(</span><span class="st">"*2010-2022  |  Pure Passing is &gt;= 70%</span></span>
<span><span class="st">                  Chance of Pass Attempt*"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tab_stubhead</span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Quarterback"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gt_img_rows</span><span class="op">(</span><span class="va">headshot</span>, height <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_label</span><span class="op">(</span></span>
<span>    passer <span class="op">=</span> <span class="st">"Quarterback"</span>,</span>
<span>    headshot <span class="op">=</span> <span class="st">""</span>,</span>
<span>    season <span class="op">=</span> <span class="st">"Season"</span>,</span>
<span>    total_attempts <span class="op">=</span> <span class="st">"Attempts"</span>,</span>
<span>    mean_cpoe <span class="op">=</span> <span class="st">"Mean CPOE"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_move_to_start</span><span class="op">(</span></span>
<span>    columns <span class="op">=</span> <span class="va">headshot</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_align</span><span class="op">(</span>align <span class="op">=</span> <span class="st">"center"</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"passer"</span>, <span class="st">"total_attempts"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gt_color_box</span><span class="op">(</span><span class="va">mean_cpoe</span>, domain <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">11</span>,</span>
<span>               palette <span class="op">=</span> <span class="st">"ggsci::blue_material"</span>, accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tab_source_note</span><span class="op">(</span></span>
<span>    source_note <span class="op">=</span> <span class="fu">md</span><span class="op">(</span><span class="st">"*An Introduction to NFL Analytics with R*&lt;br&gt;</span></span>
<span><span class="st">                     **Brad J. Congelio**"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gtExtras</span><span class="fu">::</span><span class="fu"><a href="https://jthomasmock.github.io/gtExtras/reference/gt_theme_538.html">gt_theme_538</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/show_gt_table_5_7bad0ec62fef5c2fbc64150d8c18a46e">
<div class="cell-output-display">
<p><img src="images/gt_table_5.png" style="width:95.0%;height:95.0%"></p>
</div>
</div>
</section><section id="creating-a-shiny-app" class="level2" data-number="4.17"><h2 data-number="4.17" class="anchored" data-anchor-id="creating-a-shiny-app">
<span class="header-section-number">4.17</span> Creating a Shiny App</h2>
<p>With a solid understanding of the data visualization process, we can now turn our attention to take a completed data frame and transitioning it into a Shiny App, resulting in an interactive application for users to explore your data and findings.</p>
<p>To do this, we will be utilize a data frame that you will see again in Chapter 5 that is created during an XGBoost modeling process. It contains the actual rushing yards and expected rushing yards, based on predictive machine learning, for all running backs from 2016 to 2022. You can read in the data to view it with the following <code>vroom</code> code.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/reading-in-shiny-app-data_e7e6136ad8a9c920842314cd64867ce4">
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ryoe_shiny</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/ryoe-projs"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting <code>ryoe_shiny</code> data frame contains information regarding <code>actual_yards</code>, <code>season</code>, <code>down</code>, <code>ydstogo</code>, <code>red_zone</code>, <code>rusher</code>, <code>rusher_player_id</code>, <code>posteam</code>, <code>defteam</code>, <code>exp_yards</code>. As you will soon see, despite being in the data frame, will will not use all of the variables while also adding some in the backend of the Shiny App. To that end, the Shiny App we will be producing will allow users to select one or more seasons to see each running back’s total rushing yards, total expected yards, and the difference between the two (where a positive number indicates the running back gained more yards than the XGBoost model predicted). Users will be able to select specific downs and yards to go, as well as indicate if they want to see the information pertaining to only those rushing attempts in the red zone. We will also build in the capability for the Shiny App to automatically update and format a <code>ggplot</code> scatterplot to visualize the information.</p>
<p>You can see the end result and the functioning Shiny App here: <a href="https://bcongelio.shinyapps.io/nfl_r_book_ryoe/">NFL Analytics with R: RYOE Shiny App</a>.</p>
<section id="requirements-for-a-shiny-app" class="level3" data-number="4.17.1"><h3 data-number="4.17.1" class="anchored" data-anchor-id="requirements-for-a-shiny-app">
<span class="header-section-number">4.17.1</span> Requirements for a Shiny App</h3>
<p>First, it is important to know that a Shiny App cannot be built within a typical R script. Rather, you must select “Shiny Web App” from File -&gt; New File inside RStudio. You will then be prompted to indicate the folder in which you would like to save the files and whether or not you want a combined file or a separate <code>ui.R</code> and <code>server.R</code>. A single file containing both is acceptable for a simple Shiny App but more complex designs will require separate files to maintain organization.</p>
<ol type="1">
<li>
<strong>User Interface (<code>ui.R</code></strong>) - the <code>ui.R</code> file controls the layout and appearance of your Shiny App, including controlling all the elements of the user interface such as text, inputs, sliders, checkboxes, tables, and plots. The most basic requirements to construct a user interface are <code>fluidpage()</code>, <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout()</a></code>, <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel()</a></code>, and <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel()</a></code>. The <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel()</a></code> is what contains the options for user input, while <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel()</a></code> is where the results of the input display in the web app.</li>
<li>
<strong>Server Function (<code>server.R</code></strong>) - the <code>server.R</code> file contains the information needed to build and modify the outputs in response to user input, as well as where you construct the inner-workings of the Shiny App (like data manipulation). Each <code>server.R</code> file will contain a <code>function(input, output)</code> where the <code>input</code> is an object that contains the requests from the user input and <code>output</code> is the required items to be rendered.</li>
</ol>
<p>Both the <code>ui.R</code> and <code>server.R</code> are ultimately passed into the <code><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp()</a></code> function that outputs the final product.</p>
</section><section id="building-our-ui.r-file" class="level3" data-number="4.17.2"><h3 data-number="4.17.2" class="anchored" data-anchor-id="building-our-ui.r-file">
<span class="header-section-number">4.17.2</span> Building our <code>ui.R</code> File</h3>
<p>Both the <code>ui.R</code> and <code>server.R</code> files will start with similar information: reading in the data, any necessary preparation, and - in our case - including the custom <code>nfl_analytics_theme()</code> to be passed into the <code>ggplot</code> output.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/shiny-ui-1_e267776faa1db8e586b6cc5ac6340cee">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com/">gt</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vroom.r-lib.org">vroom</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ryoe_shiny</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/ryoe-projs"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ryoe_shiny</span> <span class="op">&lt;-</span> <span class="va">ryoe_shiny</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ydstogo</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">teams</span> <span class="op">&lt;-</span> <span class="fu">nflreadr</span><span class="fu">::</span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_teams.html">load_teams</a></span><span class="op">(</span>current <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">team_abbr</span>, <span class="va">team_logo_wikipedia</span>, <span class="va">team_color</span>, <span class="va">team_color2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ryoe_shiny</span> <span class="op">&lt;-</span> <span class="va">ryoe_shiny</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">teams</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"posteam"</span> <span class="op">=</span> <span class="st">"team_abbr"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nfl_analytics_theme</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">base_size</span> <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Roboto"</span>,</span>
<span>                        size <span class="op">=</span> <span class="va">base_size</span>,</span>
<span>                        color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    plot.title.position <span class="op">=</span> <span class="st">"plot"</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_markdown</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span>,</span>
<span>                                  vjust <span class="op">=</span> <span class="fl">.02</span>,</span>
<span>                                  hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu">element_markdown</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    plot.caption <span class="op">=</span> <span class="fu">element_markdown</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.major <span class="op">=</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#d0d0d0"</span><span class="op">)</span>,</span>
<span>    panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#f7f7f7"</span><span class="op">)</span>,</span>
<span>    plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#f7f7f7"</span><span class="op">)</span>,</span>
<span>    panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#F7F7F7"</span><span class="op">)</span>,</span>
<span>    legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#F7F7F7"</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    legend.title.align <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After gathering the data into a data frame called <code>ryoe_shiny</code>, we use <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> to limited the rushes plays to just those with 10 or less yards to go, and then use the <code>load_teams()</code> function from <code>nflreadr</code> to merge in <code>team_color</code>, <code>team_color2</code>, and <code>team_logo_wikipedia</code>. After pasting in our existing code for the custom theme, we can construct the user interface.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/shiny-ui-2_b7c47efed360512c660478afbfc517a0">
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op">(</span><span class="st">"NFL Analytics with R: RYOE Shiny App"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span>fluid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"Season:"</span>,</span>
<span>                  choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">ryoe_shiny</span><span class="op">$</span><span class="va">season</span><span class="op">)</span>,</span>
<span>                  selected <span class="op">=</span> <span class="cn">NULL</span>, multiple <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span><span class="st">"down"</span>, <span class="st">"Down:"</span>,</span>
<span>                  min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">ryoe_shiny</span><span class="op">$</span><span class="va">down</span><span class="op">)</span>,</span>
<span>                  max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">ryoe_shiny</span><span class="op">$</span><span class="va">down</span><span class="op">)</span>,</span>
<span>                  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">ryoe_shiny</span><span class="op">$</span><span class="va">down</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span><span class="st">"ydstogo"</span>, <span class="st">"Yards to Go:"</span>,</span>
<span>                  min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">ryoe_shiny</span><span class="op">$</span><span class="va">ydstogo</span><span class="op">)</span>,</span>
<span>                  max <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">ryoe_shiny</span><span class="op">$</span><span class="va">ydstogo</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/checkboxInput.html">checkboxInput</a></span><span class="op">(</span><span class="st">"red_zone"</span>, <span class="st">"Red Zone:"</span>, value <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">tableOutput</a></span><span class="op">(</span><span class="st">"myTable"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"myPlot"</span>, width <span class="op">=</span> <span class="st">"500px"</span><span class="op">)</span>,</span>
<span>      width <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We begin constructing the user interface by calling in the <code><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage()</a></code> function. Each “fluid page” in a Shiny application consists of rows, which are created either either with <code><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidRow()</a></code>/<code><a href="https://rdrr.io/pkg/shiny/man/column.html">column()</a></code> function or, in our case, by using <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout()</a></code>. Within <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout()</a></code>, we can provide the arguments for both <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel()</a></code>, which is the column that contains the user input controls, and <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel()</a></code> which shows the requested outputs.</p>
<p>Within the <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel()</a></code>, we begin inputting the options that users will be able to select. There are several different options in which you can allow users manipulate the data, including text inputs, selection inputs, check boxes, radio buttons, date inputs, and even file uploads. For the purposes of our application, we are providing four different options for input using four different options of input type:</p>
<ol type="1">
<li>users can select a specific season/seasons using <code><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput()</a></code>. The first <code>season</code> in the input indicates the specific column name from the data to use, while the uppercase <code>Season:</code> is the title of the input that displays on the application. Within <code>choices</code>, we use the <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code> function to pass in the individual season values in the data (2016, 2017, 2018, 2019, 2020, 2021, and 2022). While the <code>selected</code> argument permits “pre-filling” the input with a selection, we will leave it at <code>NULL</code> and then set <code>multiple</code> to <code>TRUE</code> to allow for users to select more than one season at once.</li>
<li>Each <code><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput()</a></code> allows the user to select from a predetermined set values: either 1-4 for down and 1-10 for yards to go. The <code>min</code> and <code>max</code> arguments are set to 1st and 4th down and 1 yard to go and 10 yards to go, respectively. For <code>value</code>, we are supplying all the numeric values in the data so that the user sees each number on the input bar.</li>
<li>Finally, the <code>checkboxInput</code> is permits users to either select/deselect the <code>Red Zone</code> argument to view the data when the offense is either in or outside of the opposing red zone.</li>
</ol>
<p>The <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel()</a></code> options takes information that is constructed within the <code>server.R</code> file (specifically, in this case, a table with results and the including scatterplot of the data) and displays it beside the user input area. We are also instructing the plot is to have a width of 500px with the totality of the <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel()</a></code> having, itself, a width of 6.</p>
</section><section id="building-our-server.r-file" class="level3" data-number="4.17.3"><h3 data-number="4.17.3" class="anchored" data-anchor-id="building-our-server.r-file">
<span class="header-section-number">4.17.3</span> Building our <code>server.R</code> File</h3>
<p>The <code>server.R</code> file begins with three different arguments.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/server-r-beginnings_0add72314f3b620b303cf0c5330f29c6">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  selectedSeasons <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(input<span class="sc">$</span>season, <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  filteredData <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    ryoe_shiny <span class="sc">%&gt;%</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>        season <span class="sc">%in%</span> input<span class="sc">$</span>season,</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>        down <span class="sc">&gt;=</span> input<span class="sc">$</span>down[<span class="dv">1</span>] <span class="sc">&amp;</span> down <span class="sc">&lt;=</span> input<span class="sc">$</span>down[<span class="dv">2</span>],</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>        ydstogo <span class="sc">&gt;=</span> input<span class="sc">$</span>ydstogo[<span class="dv">1</span>] <span class="sc">&amp;</span> ydstogo <span class="sc">&lt;=</span> input<span class="sc">$</span>ydstogo[<span class="dv">2</span>],</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>        red_zone <span class="sc">==</span> input<span class="sc">$</span>red_zone</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each <code>server.R</code> file will begin with <code>function(input, output)</code> with the specifics of each application coming after. After, the first object created in the Shiny App is <code>selectedSeasons</code> which stores the season(s) that the user selects so that the values can be placed in the resulting <code>ggplot</code> data visualization. After, we take our <code>ryoe_shiny</code> data frame and wrap it inside the <code><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive()</a></code> function and write it into a data frame called <code>filteredData</code>, thus causing <code>filteredData</code> to become what is called a “reactive expression.” Reactive expressions are what give Shiny the ability to update outputs (like tables and plots, in our case) in response to user input.</p>
<p>The information <em>after</em> the <code><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive()</a></code> function is the data that is to be updated in real time. For our Shiny App, we are using the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function to keep only the criteria from <code>ryoe_shiny</code> that the user request. That is, we are filtering for the <code>season</code> in the data frame that includes (<code>%in%</code>) the season(s) selected on the user interface. The filtering of <code>down</code> is done by instructing that the first <code>down</code> must be greater than or equal to the user input while the second <code>down</code> must be less than or equal to. The <code>[1]</code> and <code>[2]</code> including in both <code>down</code> and <code>ydstogo</code> are indices that specify the first and second elements of the value. For example, if the user selects a range of <code>down</code> from first to third, <code>input$down[1]</code> would be <code>1</code> and <code>input$down[2]</code> would be <code>3</code> (with the equivalent <code>tidyverse</code> version of it being <code>filter(down &gt;= 1 &amp; down &lt;= 3)</code>. Last, if the box is checked for <code>red_zone</code>, it will filter the data to include only those plays that include the binary <code>1</code> in the <code>red_zone</code> variable.</p>
<p>The data, now filtered based on the user input, can be passed into the output table and plot.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/ryoe-shiny-table-plot_cdccae32ea1e7578bc367fdd43af6c76">
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span>  <span class="va">output</span><span class="op">$</span><span class="va">myTable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">renderTable</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">resultTable</span> <span class="op">&lt;-</span> <span class="fu">filteredData</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">rusher</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>        total_rushes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        total_actual_yards <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">actual_yards</span><span class="op">)</span><span class="op">)</span>,  </span>
<span>        total_expected_yards <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">exp_yards</span><span class="op">)</span><span class="op">)</span>,       </span>
<span>        difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">actual_yards</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">exp_yards</span><span class="op">)</span><span class="op">)</span> </span>
<span>      <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span></span>
<span>        <span class="st">"Rusher"</span> <span class="op">=</span> <span class="va">rusher</span>,</span>
<span>        <span class="st">"Total Rushes"</span> <span class="op">=</span> <span class="va">total_rushes</span>,</span>
<span>        <span class="st">"Total Actual Yards"</span> <span class="op">=</span> <span class="va">total_actual_yards</span>,</span>
<span>        <span class="st">"Total Expected Yards"</span> <span class="op">=</span> <span class="va">total_expected_yards</span>,</span>
<span>        <span class="st">"Difference"</span> <span class="op">=</span> <span class="va">difference</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">Difference</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>        <span class="va">resultTable</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To create the output table, we use the <code><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">renderTable()</a></code> function, another reactive element within the Shiny App. We write the information contained in <code>filteredData()</code> (which was created above during the <code><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive()</a></code> filtering process) to a new data frame called <code>resultTable</code>. After, we handle the data just like we would within the <code>tidyverse</code> outside of <code>Shiny</code>, aside from ensuring the information is written out in data frame form by including <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> at the end. All of this is ultimately written into the <code>output$myTable</code> to be passed along to the user interface. As highlighted in the below code, outputting the <code>ggplot</code> is done in the same fashion, except for the use of <code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot()</a></code>. After, we create the data frame called <code>top10</code> that is also built off of the filtered data contained in <code>filteredData()</code>. After, the process includes the basic tenants of <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>, and building out the visualization in <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/r-shiny-plot_a630d5de9e339d8528c2798aa0553aee">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>myPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    top10 <span class="ot">&lt;-</span> <span class="fu">filteredData</span>() <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(rusher) <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">team_color =</span> <span class="fu">last</span>(team_color),</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">total_actual_yards =</span> <span class="fu">as.integer</span>(<span class="fu">sum</span>(actual_yards)),  </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">total_expected_yards =</span> <span class="fu">as.integer</span>(<span class="fu">sum</span>(exp_yards))      </span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">top_n</span>(<span class="dv">10</span>, <span class="at">wt =</span> total_actual_yards)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> top10, <span class="fu">aes</span>(<span class="at">x =</span> total_actual_yards,</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">y =</span> total_expected_yards)) <span class="sc">+</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_poly_line</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_poly_eq</span>(<span class="at">mapping =</span> <span class="fu">use_label</span>(<span class="fu">c</span>(<span class="st">"R2"</span>, <span class="st">"P"</span>)),</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">p.digits =</span> <span class="dv">2</span>,</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.x =</span> .<span class="dv">20</span>,</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.y =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> top10<span class="sc">$</span>team_color, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text_repel</span>(<span class="at">data =</span> top10, <span class="fu">aes</span>(<span class="at">label =</span> rusher)) <span class="sc">+</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Total Actual Yards"</span>, </span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Total Expected Yards"</span>, </span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Actual Rushing Yards vs. Expected for Season(s):"</span>,</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">selectedSeasons</span>()),</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Model: *LightGBM* in **tidymodels**"</span>) <span class="sc">+</span></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">nfl_analytics_theme</span>()</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">width =</span> <span class="dv">500</span>)</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you build the <code>Shiny</code> app, you can check the validity of your coding by clicking the <code>Run App</code> button in the upper-right part of the coding screen. If everything is correct, the application will run within your local system. If there are issues, the information will be provided in the ‘Console’ area of RStudio. Once you are content with functioning and style of the application, you can publish it and host it, for free, on <a href="https://www.shinyapps.io/">ShinyApps.io</a>.</p>
</section></section><section id="exercises" class="level2" data-number="4.18"><h2 data-number="4.18" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">4.18</span> Exercises</h2>
<p>The answers for the following answers can be found here: <a href="http://nfl-book.bradcongelio.com/ch4-answers" class="uri">http://nfl-book.bradcongelio.com/ch4-answers</a>.</p>
<section id="exercise-1" class="level3" data-number="4.18.1"><h3 data-number="4.18.1" class="anchored" data-anchor-id="exercise-1">
<span class="header-section-number">4.18.1</span> Exercise 1</h3>
<p>To begin, run the following code to create the data frame titled <code>rb_third_down</code>:</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/exercise-1-ch-4_6b17e6749c33051273c4e993b0cb36b0">
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu">nflreadr</span><span class="fu">::</span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rb_third_down</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">play_type</span> <span class="op">==</span> <span class="st">"run"</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">rusher</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">down</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">&amp;</span> <span class="va">ydstogo</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">rusher</span>, <span class="va">rusher_player_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    total_first <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">yards_gained</span> <span class="op">&gt;=</span> <span class="va">ydstogo</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    total_pct <span class="op">=</span> <span class="va">total_first</span> <span class="op">/</span> <span class="va">total</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">total</span> <span class="op">&gt;=</span> <span class="fl">20</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">total_pct</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After, do the following:</p>
<ol type="1">
<li>Create a <code>geom_col</code> plot</li>
<li>Place <code>rusher_player_id</code> on the x-axis and <code>total_pct</code> on the y-axis</li>
<li>Reorder <code>rusher</code> in descending order by <code>total_pct</code>
</li>
<li>On the y-axis, set the <code>breaks</code> and <code>labels</code> use the <code>scales::</code> option (note: the y-axis should be in percent format)</li>
<li>Again on the y-axis, use <code>expand = c(0,0)</code> to remove the space of the bottom of the plot</li>
<li>Use <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab()</a></code> to add a title to <em>only</em> the y-axis</li>
<li>Use the <code>nflplotR</code> package, add the primary team color as the column <code>fill</code> and secondary as <code>color</code>
</li>
<li>Use the <code>nflplotR</code> package, edit the <code>axis.text.x</code> within the <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> option to add the player headshots</li>
<li>Add <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal()</a></code> to the plot</li>
<li>Use <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code> to include a title and subtitle</li>
</ol></section><section id="exercise-2" class="level3" data-number="4.18.2"><h3 data-number="4.18.2" class="anchored" data-anchor-id="exercise-2">
<span class="header-section-number">4.18.2</span> Exercise 2</h3>
<p>Run the code below to create the <code>offensive_epa</code> data frame, then follow the instructions below to complete the exercise.</p>
<div class="cell" data-hash="04-nfl-analytics-visualization_cache/html/ch-4-ex-2_0042df088542e1cea93ab0ee7927ba2d">
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu">nflreadr</span><span class="fu">::</span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">offensive_epa</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">posteam</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">down</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">posteam</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">epa</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Place <code>mean_epa</code> on the x-axis and <code>posteam</code> on the y-axis, using reordering the teams by <code>mean_epa</code>
</li>
<li>Use <code>geom_col</code> with the <code>posteam</code> set as both the <code>color</code> and <code>fill</code> and add a <code>width</code> of 0.75</li>
<li>Use <code>nflplotR</code> to set the <code>color</code> and <code>fill</code> to “secondary” and “primary”</li>
<li>Add a <code>geom_vline</code> with an <code>xintercept</code> of 0, add the color as “black” and a <code>linewidth</code> of 1</li>
<li>Use <code>nflplotR</code> to add team logos to the end of each bar</li>
<li>Use <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal()</a></code>
</li>
<li>Remove the y-axis text with <code>axis.text.y</code> within <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code>
</li>
<li>Use <code>xlab</code>, <code>ylab</code>, and <code>labs</code> to add the x-axis label and the title/subtitle</li>
</ol>


<div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="list" style="display: none">
<div id="ref-stikeleather2013" class="csl-entry" role="listitem">
Stikeleather, J. (2013). <em>The three elements of successful data visualizations</em>. Retrieved from <a href="https://hbr.org/2013/04/the-three-elements-of-successf">https://hbr.org/2013/04/the-three-elements-of-successf</a>
</div>
</div>
</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>As listed on the <code>ggrepel</code> website: <a href="https://ggrepel.slowkow.com/articles/examples.html" class="uri">https://ggrepel.slowkow.com/articles/examples.html</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./03-nfl-analytics-functions.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">NFL Analytics with the <code>nflverse</code> Family of Packages</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05-nfl-analytics-advanced-methods.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Advanced Model Creation with NFL Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>